--source include/have_debug_sync.inc
--source include/count_sessions.inc

--connect (con1,localhost,root)
--connection default
create table t1 (a int) engine=innodb;
insert into t1 values(1);
show status like 'super_read_only_block_microsec';

insert into t1 values(1);
set debug_sync='RESET';
set debug_sync='ha_commit_trans_after_acquire_commit_lock WAIT_FOR go';
--send insert into t1 values(1)

--connection con1
select sleep(1.1);
--let $exec = `show status like 'super_read_only_block_microsec'`
--let $assert_text = super_read_only_block_microsec is bigger than 1100000
--let $assert_cond = [select substring("$exec", 32)+0] > 1100000
--source include/assert.inc

set debug_sync='now SIGNAL go';
select sleep(1.1);
show status like 'super_read_only_block_microsec';

set debug_sync= 'RESET';
--disconnect con1

--connection default
--reap
drop table t1;

--source include/wait_until_count_sessions.inc

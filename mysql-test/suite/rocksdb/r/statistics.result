SET GLOBAL rocksdb_seconds_between_stat_computes=2;
DROP TABLE IF EXISTS t1;
DROP TABLE IF EXISTS t2;
DROP TABLE IF EXISTS t3;
DROP TABLE IF EXISTS t4;
DROP TABLE IF EXISTS t5;
create table t1(id bigint not null primary key auto_increment, a varchar(255) not null, b bigint) engine=rocksdb;
create table t2(id bigint not null primary key auto_increment, a varchar(255) not null, b bigint) engine=rocksdb;
insert t2(a, b) select a, b from t1;
create table t3(id bigint not null primary key auto_increment, a varchar(255) not null, b bigint) engine=rocksdb;
insert t3(a, b) select a, b from t1;
create table t4(id bigint not null primary key auto_increment, a varchar(255) not null, b bigint) engine=rocksdb;
insert t4(a, b) select a, b from t1;
create table t5(id bigint not null primary key auto_increment, a varchar(255) not null, b bigint) engine=rocksdb;
insert t5(a, b) select a, b from t1 where id < 50000;
create index t1_1 on t1(b);
create index t3_1 on t3(b) comment 'cf_t3';
create index t4_1 on t4(b) comment 'rev:cf_t4';
SELECT table_name, table_rows FROM information_schema.tables WHERE table_schema = DATABASE();
table_name	table_rows
t1	100000
t2	100000
t3	100000
t4	49000
t5	49999
set global rocksdb_force_flush_memtable_now = true;
SELECT table_name, table_rows FROM information_schema.tables WHERE table_schema = DATABASE();
table_name	table_rows
t1	100000
t2	100000
t3	100000
t4	100000
t5	49999
create index t4_2 on t4(a);
set global rocksdb_force_flush_memtable_now = true;
SELECT table_name, table_rows FROM information_schema.tables WHERE table_schema = DATABASE();
table_name	table_rows
t1	100000
t2	100000
t3	100000
t4	100000
t5	49999
SELECT table_name, table_rows FROM information_schema.tables WHERE table_schema = DATABASE();
table_name	table_rows
t1	100000
t2	100000
t3	100000
t4	100000
t5	49999
analyze table t1,t2,t3,t4,t5;
Table	Op	Msg_type	Msg_text
test.t1	analyze	status	OK
test.t2	analyze	status	OK
test.t3	analyze	status	OK
test.t4	analyze	status	OK
test.t5	analyze	status	OK
Recomputed stats for 3 indexes across 1 files
Recomputed stats for 2 indexes across 1 files
Recomputed stats for 1 indexes across 1 files
Recomputed stats for 3 indexes across 2 files
Recomputed stats for 3 indexes across 1 files
SELECT table_name, table_rows FROM information_schema.tables WHERE table_schema = DATABASE();
table_name	table_rows
t1	100000
t2	100000
t3	100000
t4	100000
t5	49999
drop table t1;
drop table t2;
drop table t3;
drop table t4;
drop table t5;
SET GLOBAL rocksdb_seconds_between_stat_computes = 3600;

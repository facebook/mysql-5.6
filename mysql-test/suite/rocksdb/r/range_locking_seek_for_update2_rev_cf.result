show variables like 'rocksdb_use_range_locking';
Variable_name	Value
rocksdb_use_range_locking	ON
create table t0(a int primary key);
insert into t0 values (0),(1),(2),(3),(4),(5),(6),(7),(8),(9);
create table t1 (
pk int,
a int,
primary key (pk) comment 'rev:rlsfu_test'
) engine=rocksdb;
insert into t1 (pk)
select
A.a + B.a*10 + C.a*100
from 
t0 A, t0 B, t0 C;
delete from t1 where pk<100;
connect  con1,localhost,root,,;
connection con1;
begin;
set debug_sync='rocksdb.locking_iter_scan SIGNAL about_to_lock_range WAIT_FOR spoiler_inserted';
select * from t1 where pk >=5 order by pk limit 5 for update;
connection default;
set debug_sync='now WAIT_FOR about_to_lock_range';
insert into t1 (pk) values 
(10),(20),(30),(40),(50);
set debug_sync='now SIGNAL spoiler_inserted';
connection con1;
pk	a
10	NULL
20	NULL
30	NULL
40	NULL
50	NULL
# This must return 1, no 5:
select lock_count from information_schema.rocksdb_trx
where thread_id=CONNECTION_ID();
lock_count
1
rollback;
disconnect con1;
connection default;
drop table t0, t1;

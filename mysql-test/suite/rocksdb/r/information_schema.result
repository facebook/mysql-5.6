DROP TABLE IF EXISTS t1;
DROP TABLE IF EXISTS t2;
DROP TABLE IF EXISTS t3;
select * from INFORMATION_SCHEMA.ROCKSDB_GLOBAL_INFO;
TYPE	NAME	VALUE
MAX_INDEX_ID	MAX_INDEX_ID	max_index_id
CF_FLAGS	0	default [0]
CF_FLAGS	1	__system__ [0]
select count(*) from INFORMATION_SCHEMA.ROCKSDB_GLOBAL_INFO;
count(*)
3
CREATE TABLE t1 (i1 INT, i2 INT, PRIMARY KEY (i1)) ENGINE = ROCKSDB;
INSERT INTO t1 VALUES (1, 1), (2, 2), (3, 3);
select * from INFORMATION_SCHEMA.ROCKSDB_GLOBAL_INFO;
TYPE	NAME	VALUE
BINLOG	FILE	master-bin.000001
BINLOG	POS	1083
BINLOG	GTID	uuid:5
MAX_INDEX_ID	MAX_INDEX_ID	max_index_id
CF_FLAGS	0	default [0]
CF_FLAGS	1	__system__ [0]
select count(*) from INFORMATION_SCHEMA.ROCKSDB_GLOBAL_INFO;
count(*)
6
CREATE INDEX tindex1 on t1 (i1);
CREATE INDEX tindex2 on t1 (i2);
select * from INFORMATION_SCHEMA.ROCKSDB_GLOBAL_INFO where TYPE = 'CF_FLAGS';
TYPE	NAME	VALUE
CF_FLAGS	0	default [0]
CF_FLAGS	1	__system__ [0]
CREATE TABLE t2 (
a int,
b int,
c int,
d int,
e int,
PRIMARY KEY (a) COMMENT "cf_a",
KEY (b) COMMENT "cf_b",
KEY (c) COMMENT "cf_c",
KEY (d) COMMENT "$per_index_cf",
KEY (e) COMMENT "rev:cf_d") ENGINE=ROCKSDB;
select * from INFORMATION_SCHEMA.ROCKSDB_GLOBAL_INFO where TYPE = 'CF_FLAGS';
TYPE	NAME	VALUE
CF_FLAGS	0	default [0]
CF_FLAGS	1	__system__ [0]
CF_FLAGS	2	cf_a [0]
CF_FLAGS	3	cf_b [0]
CF_FLAGS	4	cf_c [0]
CF_FLAGS	5	test.t2.d [2]
CF_FLAGS	6	rev:cf_d [1]
CREATE TABLE t3 (a INT, PRIMARY KEY (a)) ENGINE=ROCKSDB;
SET GLOBAL ROCKSDB_PAUSE_BACKGROUND_WORK=1;
DROP TABLE t3;
Max dropped index id reflect the newest index being dropped
SET GLOBAL ROCKSDB_PAUSE_BACKGROUND_WORK=0;
next line shouldn't cause assertion to fail
SET GLOBAL ROCKSDB_PAUSE_BACKGROUND_WORK=0;
DROP TABLE t1;
DROP TABLE t2;

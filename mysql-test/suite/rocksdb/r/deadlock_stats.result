CREATE TABLE t1 (
id int primary key, 
value int
) engine=rocksdb collate latin1_bin;
insert into t1 values (1,1),(2,2),(3,3),(4,4),(5,5),(6,6),(7,7),(8,8),(9,9),(10,10);
connect  con1,localhost,root,,;
connection con1;
BEGIN;
SELECT * FROM t1 WHERE id=3;
id	value
3	3
connect  con2,localhost,root,,;
connection con2;
BEGIN;
SELECT * FROM t1 WHERE id=3;
id	value
3	3
connection default;
BEGIN;
UPDATE t1 SET value=30 WHERE id=3;
COMMIT;
connection con1;
SELECT * FROM t1 WHERE id=3 FOR UPDATE;
ERROR 40001: Deadlock found when trying to get lock; try restarting transaction (snapshot conflict)
SELECT INNODB_DEADLOCKS from information_schema.table_statistics where table_name="t1";
INNODB_DEADLOCKS
1
SELECT INNODB_DEADLOCKS from information_schema.table_statistics where table_name="t1";
INNODB_DEADLOCKS
1
SELECT INNODB_DEADLOCKS from information_schema.table_statistics where table_name="t1";
INNODB_DEADLOCKS
1
SELECT * FROM t1 WHERE id=3 FOR UPDATE;
ERROR 40001: Deadlock found when trying to get lock; try restarting transaction (snapshot conflict)
SELECT INNODB_DEADLOCKS from information_schema.table_statistics where table_name="t1";
INNODB_DEADLOCKS
2
SELECT INNODB_DEADLOCKS from information_schema.table_statistics where table_name="t1";
INNODB_DEADLOCKS
2
connection con2;
SELECT * FROM t1 WHERE id=3 FOR UPDATE;
ERROR 40001: Deadlock found when trying to get lock; try restarting transaction (snapshot conflict)
SELECT INNODB_DEADLOCKS from information_schema.table_statistics where table_name="t1";
INNODB_DEADLOCKS
3
ROLLBACK;
disconnect con1;
disconnect con2;
connection default;
drop table t1;

--source include/have_rocksdb.inc

#
# This test checks some very basic capabilities
# for tables without primary keys. A hidden pk will be generated under the hood
# in myrocks.  Everything should work here as normal.
#

--disable_warnings
DROP TABLE IF EXISTS t1;
--enable_warnings

# test CREATE
#CREATE TABLE t1 (a INT, b CHAR(8), pk INT AUTO_INCREMENT PRIMARY KEY) ENGINE=rocksdb;
CREATE TABLE t1 (a INT, b CHAR(8)) ENGINE=rocksdb;

# test CREATE w/SK
# remember to test SK later

SHOW CREATE TABLE t1;
SHOW COLUMNS IN t1;

# TODO this seg faults!
# ALTER TABLE t1 ADD COLUMN c INT;
# SHOW CREATE TABLE t1;

## test INSERT
INSERT INTO t1 (a,b) VALUES (35,'foo');
INSERT INTO t1 (a,b) VALUES (76,'bar');
INSERT INTO t1 (a,b) VALUES (77,'baz');
--sorted_result
SELECT * FROM t1;

# test RESTART/OPEN
#--source include/restart_mysqld.inc
#
#INSERT INTO t1 (a,b) VALUES (45,'bob');
#--sorted_result
#SELECT * FROM t1;

# test UPDATE
UPDATE t1 SET a=a+100;
--sorted_result
SELECT * FROM t1;

UPDATE t1 SET a=a-100, b='bbb' WHERE a>100;
UPDATE t1 SET a=300, b='ccc' WHERE a>70;
UPDATE t1 SET a=123 WHERE a=35;
UPDATE t1 SET a=321 WHERE b='ccc';

# test SELECT
--sorted_result
SELECT a,b FROM t1 WHERE a>76;
--sorted_result
SELECT a,b FROM t1 WHERE a=123 AND b='bbb';
--sorted_result
SELECT a,b FROM t1;

# test DELETE
DELETE FROM t1 WHERE a=123;
--sorted_result
SELECT * FROM t1;

DELETE FROM t1 WHERE b > 'bbb';
--sorted_result
SELECT * FROM t1;

# test DROP
DROP TABLE t1;

# test ALTER
#CREATE TABLE t1 (a INT, c CHAR(8)) ENGINE=rocksdb;
#INSERT INTO t1 VALUES (1,'a'),(5,'z');

#ALTER TABLE t1 ADD COLUMN b INT;
#SHOW CREATE TABLE t1;

#--sorted_result
#SELECT * FROM t1;

#ALTER TABLE t1 DROP COLUMN b;
#SHOW CREATE TABLE t1;
#DROP TABLE t1;

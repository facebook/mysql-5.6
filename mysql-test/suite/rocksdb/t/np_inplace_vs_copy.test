--source include/have_rocksdb.inc

CREATE TABLE t1 (id INT AUTO_INCREMENT PRIMARY KEY) PARTITION BY RANGE(id) 
  (PARTITION p0 VALUES LESS THAN (10), 
   PARTITION p1 VALUES LESS THAN (20), 
   PARTITION p2 VALUES LESS THAN (30), 
   PARTITION p3 VALUES LESS THAN (40), 
   PARTITION p4 VALUES LESS THAN (50), 
   PARTITION p5 VALUES LESS THAN MAXVALUE);
INSERT INTO t1 VALUES (NULL), (NULL), (NULL), (NULL), (NULL), (NULL), (NULL), (NULL), (NULL), (NULL),
  (NULL), (NULL), (NULL), (NULL), (NULL), (NULL), (NULL), (NULL), (NULL), (NULL),
  (NULL), (NULL), (NULL), (NULL), (NULL), (NULL), (NULL), (NULL), (NULL), (NULL),
  (NULL), (NULL), (NULL), (NULL), (NULL), (NULL), (NULL), (NULL), (NULL), (NULL),
  (NULL), (NULL), (NULL), (NULL), (NULL), (NULL), (NULL), (NULL), (NULL), (NULL),
  (NULL), (NULL), (NULL), (NULL), (NULL), (NULL), (NULL), (NULL), (NULL), (NULL);
SELECT COUNT(id) FROM t1;

# data from p3 reorganized into p4
ALTER TABLE t1 ALGORITHM=COPY, DROP PARTITION p3;
SELECT PARTITION_NAME FROM information_schema.rocksdb_ddl WHERE TABLE_NAME="t1" ORDER BY PARTITION_NAME;
SELECT COUNT(id) FROM t1;
SELECT COUNT(id) FROM t1 WHERE id >= 30 AND id < 40;
--replace_column 13 # 14 # 15 # 16 # 17 # 18 # 19 # 20 # 21 #
SELECT * from information_schema.partitions WHERE
TABLE_NAME="t1" ORDER by PARTITION_NAME;
SELECT * FROM t1 PARTITION (p0);
SELECT * FROM t1 PARTITION (p1);
SELECT * FROM t1 PARTITION (p2);
SELECT * FROM t1 PARTITION (p4);
SELECT * FROM t1 PARTITION (p5);

# data from p2 deleted from table
ALTER TABLE t1 ALGORITHM=INPLACE, DROP PARTITION p2;
SELECT PARTITION_NAME FROM information_schema.rocksdb_ddl WHERE TABLE_NAME="t1" ORDER BY PARTITION_NAME;
SELECT COUNT(id) FROM t1;
SELECT COUNT(id) FROM t1 WHERE id >= 20 AND id < 30;
--replace_column 13 # 14 # 15 # 16 # 17 # 18 # 19 # 20 # 21 #
SELECT * from information_schema.partitions WHERE
TABLE_NAME="t1" ORDER by PARTITION_NAME;
SELECT * FROM t1 PARTITION (p0);
SELECT * FROM t1 PARTITION (p1);
SELECT * FROM t1 PARTITION (p4);
SELECT * FROM t1 PARTITION (p5);

DROP TABLE t1;

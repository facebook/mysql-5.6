source include/master-slave.inc;
source include/have_gtid.inc;

connection master;
let $master_uuid= `select @@server_uuid`;
create table t1 (a int);
insert into t1 values(1);
insert into t1 values(1);
insert into t1 values(1);
insert into t1 values(1);

set gtid_next = '551dab6a-d12b-11e5-a3ea-0002c9d31542:1';
insert into t1 values(1);
set gtid_next = '551dab6a-d12b-11e5-a3ea-0002c9d31542:2';
insert into t1 values(1);
set gtid_next = '551dab6a-d12b-11e5-a3ea-0002c9d31543:1';
insert into t1 values(1);
set gtid_next = AUTOMATIC;

--error ER_INVALID_UUID
purge gtid 'garbage uuid';

replace_result $master_uuid master_uuid;
--error ER_CANNOT_PURGE_SERVER_UUID
eval purge gtid '$master_uuid';

-- echo Check 'purge gtid' query resets logged and lost gtid state.
purge gtid '551dab6a-d12b-11e5-a3ea-0002c9d31542,551dab6a-d12b-11e5-a3ea-0002c9d31543';
insert into t1 values(1);
insert into t1 values(1);

replace_result $master_uuid master_uuid;
select @@global.gtid_executed;

sync_slave_with_master;
-- echo Check gtid_executed on slave is also resetted
replace_result $master_uuid master_uuid;
select @@global.gtid_executed;

connection master;
drop table t1;

source include/rpl_end.inc;

include/master-slave.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the master info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START SLAVE; see the 'START SLAVE Syntax' in the MySQL Manual for more information.
[connection master]
# Establish connection con1 (user=root)
# Establish connection con2 (user=root)
# Establish connection con3 (user=root)
# Establish connection con4 (user=root)
# reset replication to guarantee that master-bin.000001 is used
include/stop_slave.inc
RESET REPLICA;
RESET MASTER;
CHANGE REPLICATION SOURCE TO source_host="127.0.0.1",source_port=MASTER_PORT,source_user="root";
Warnings:
Note	1759	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	1760	Storing MySQL user name or password information in the master info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START SLAVE; see the 'START SLAVE Syntax' in the MySQL Manual for more information.
include/start_slave.inc
# Switch to connection con1
CREATE TABLE t1 (a INT PRIMARY KEY) ENGINE=innodb;
INSERT INTO t1 VALUES(1);
START TRANSACTION WITH CONSISTENT INNODB SNAPSHOT;
File	Position
master-bin.000001	664
# Switch to connection con2
INSERT INTO t1 VALUES(2);
INSERT INTO t1 VALUES(3);
# Switch to connection con1
SELECT * FROM t1;
a
1
COMMIT;
SELECT * FROM t1;
a
1
2
3
DROP TABLE t1;
# Switch to connection con1
CREATE TABLE t1 (a INT PRIMARY KEY) ENGINE=innodb;
INSERT INTO t1 VALUES(1);
START TRANSACTION WITH CONSISTENT INNODB SNAPSHOT;
File	Position
master-bin.000001	1961
START TRANSACTION WITH CONSISTENT INNODB SNAPSHOT;
File	Position
master-bin.000001	1961
START TRANSACTION WITH CONSISTENT INNODB SNAPSHOT;
File	Position
master-bin.000001	1961
START TRANSACTION WITH CONSISTENT INNODB SNAPSHOT;
File	Position
master-bin.000001	1961
# Switch to connection con2
INSERT INTO t1 VALUES(2);
INSERT INTO t1 VALUES(3);
# Switch to connection con1
SELECT * FROM t1;
a
1
SELECT * INTO OUTFILE '<MYSQLTEST_VARDIR>/tmp/rpl_innodb_snapshot.out.file' FROM t1;
COMMIT;
# Switch to slave
CREATE TABLE t1_backup AS SELECT * FROM t1;
include/stop_slave.inc
RESET REPLICA;
DELETE FROM t1;
LOAD DATA INFILE '<MYSQLTEST_VARDIR>/tmp/rpl_innodb_snapshot.out.file' INTO TABLE t1;
SELECT * FROM t1;
a
1
CHANGE REPLICATION SOURCE TO source_host="127.0.0.1",source_port=MASTER_PORT,source_user="root",source_log_file="master-bin.000001",source_log_pos=binlog_pos;
Warnings:
Note	1759	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	1760	Storing MySQL user name or password information in the master info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START SLAVE; see the 'START SLAVE Syntax' in the MySQL Manual for more information.
include/start_slave.inc
SELECT * FROM t1;
a
1
2
3
SELECT * FROM t1_backup;
a
1
2
3
DROP TABLE t1_backup;
DROP TABLE t1;
# Switch to connection con1
CREATE TABLE t1 (a INT PRIMARY KEY) ENGINE=innodb;
INSERT INTO t1 VALUES(1);
# async queries from con2
INSERT INTO t1 VALUES(2);
# async queries from con3
INSERT INTO t1 VALUES(21);
# Switch to connection con1
# Switch to connection con4
INSERT INTO t1 VALUES(9);
# Switch to connection con1
SELECT * INTO OUTFILE '<MYSQLTEST_VARDIR>/tmp/rpl_innodb_snapshot.out.file' FROM t1;
COMMIT;
# reap async statements
# Switch to slave
CREATE TABLE t1_backup AS SELECT * FROM t1;
include/stop_slave.inc
RESET REPLICA;
DELETE FROM t1;
LOAD DATA INFILE '<MYSQLTEST_VARDIR>/tmp/rpl_innodb_snapshot.out.file' INTO TABLE t1;
CHANGE REPLICATION SOURCE TO source_host="127.0.0.1",source_port=MASTER_PORT,source_user="root",source_log_file="master-bin.000001",source_log_pos=binlog_pos;
Warnings:
Note	1759	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	1760	Storing MySQL user name or password information in the master info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START SLAVE; see the 'START SLAVE Syntax' in the MySQL Manual for more information.
include/start_slave.inc
# sync and then query slave
ShouldBeZero
0
DROP TABLE t1_backup;
DROP TABLE t1;
# Switch to connection default + close connections con1 and con2
include/rpl_end.inc

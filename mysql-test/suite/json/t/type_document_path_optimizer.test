--source include/not_valgrind.inc
--source include/master-slave.inc
connection master;

################################################################################
###
### Test of query optimization on document path indexes
###

--disable_warnings
drop table if exists t1, t2, t3;
--enable_warnings

create table t1 (
  a1 int primary key,
  b1 int,
  c1 double,
  d1 char(100),
  doc11 document not null,
  doc12 document,

  # regular keys
  key b1_a1         (b1, a1),

  # single column keys
  key doc11_bool   (doc11.bool as bool),
  key doc11_int    (doc11.int as int),
  key doc11_double (doc11.double as double),
  key doc11_string (doc11.string as string(100)),
  key doc11_binary (doc11.binary as binary(100)),
  key doc11_nested (doc11.k1.k2.k3.int as int),
  key doc12_int    (doc12.int as int),
  key doc12_double (doc12.double as double),

  # multi-column keys
  key doc11_b1 (doc11.int as int, b1),
  key doc11_c1 (doc11.double as double, c1),
  key doc11_d1 (doc11.int as int, d1),
  key b1_doc11 (b1, doc11.int as int)
) engine = innodb;

create table t2 (
  a2 int primary key,
  b2 int,
  c2 double,
  d2 char(100),
  doc21 document not null,
  doc22 document,

  # regular keys
  key b2_a2         (b2, a2),

  # single column keys
  key doc21_bool   (doc21.bool as bool),
  key doc21_int    (doc21.int as int),
  key doc21_double (doc21.double as double),
  key doc21_string (doc21.string as string(100)),
  key doc21_binary (doc21.binary as binary(100)),
  key doc21_nested (doc21.k1.k2.k3.int as int),
  key doc22_int    (doc22.int as int),
  key doc22_double (doc22.double as double),

  # multi-column keys
  key doc21_b2 (doc21.int as int, b2),
  key doc21_c2 (doc21.double as double, c2),
  key doc21_d2 (doc21.int as int, d2),
  key b2_doc21 (b2, doc21.int as int)
) engine = innodb;

create table t3 (
  a3 int primary key,
  b3 int,
  c3 double,
  d3 char(100),
  doc31 document not null,
  doc32 document,

  # regular keys
  key b3_a3         (b3, a3),

  # single column keys
  key doc31_bool   (doc31.bool as bool),
  key doc31_int    (doc31.int as int),
  key doc31_double (doc31.double as double),
  key doc31_string (doc31.string as string(100)),
  key doc31_binary (doc31.binary as binary(100)),
  key doc31_nested (doc31.k1.k2.k3.int as int),
  key doc32_int    (doc32.int as int),
  key doc32_double (doc32.double as double),

  # multi-column keys
  key doc31_b3 (doc31.int as int, b3),
  key doc31_c3 (doc31.double as double, c3),
  key doc31_d3 (doc31.int as int, d3),
  key b3_doc31 (b3, doc31.int as int)
) engine = innodb;


insert into t1 values
(10, 10, 10.1, 'jjj', '{"bool":false, "int":10, "double":10.1, "string":"jjj", "binary":"jjj", "k1":{"k2":{"k3":{"int":10}}}, "id":10}', '{"int":10, "double":10.1}'),
(11, 11, 11.11, 'kkk', '{"bool":false, "int":11, "double":11.11, "string":"kkk", "binary":"kkk", "k1":{"k2":{"k3":{"int":11}}}, "id":11}', '{"int":11, "double":11.11}'),
(12, 12, 12.12, 'lll', '{"bool":false, "int":12, "double":12.12, "string":"lll", "binary":"lll", "k1":{"k2":{"k3":{"int":12}}}, "id":12}', '{"int":12, "double":12.12}'),
(1, 1, 1.1, 'aaa', '{"bool":true,  "int":1, "double":1.1, "string":"aaa", "binary":"aaa", "k1":{"k2":{"k3":{"int":1}}}, "id":1}', '{"int":1, "double":1.1}'),
(2, 2, 2.2, 'bbb', '{"bool":true,  "int":2, "double":2.2, "string":"bbb", "binary":"bbb", "k1":{"k2":{"k3":{"int":2}}}, "id":2}', '{"int":2, "double":2.2}'),
(3, 3, 3.3, 'ccc', '{"bool":true,  "int":3, "double":3.3, "string":"ccc", "binary":"ccc", "k1":{"k2":{"k3":{"int":3}}}, "id":3}', '{"int":3, "double":3.3}'),
(4, 4, 4.4, 'ddd', '{"bool":true,  "int":4, "double":4.4, "string":"ddd", "binary":"ddd", "k1":{"k2":{"k3":{"int":4}}}, "id":4}', '{"int":4, "double":4.4}'),
(5, 5, 5.5, 'eee', '{"bool":true,  "int":5, "double":5.5, "string":"eee", "binary":"eee", "k1":{"k2":{"k3":{"int":5}}}, "id":5}', '{"int":5, "double":5.5}'),
(6, 6, 6.6, 'fff', '{"bool":false, "int":6, "double":6.6, "string":"fff", "binary":"fff", "k1":{"k2":{"k3":{"int":6}}}, "id":6}', '{"int":6, "double":6.6}'),
(7, 7, 7.7, 'ggg', '{"bool":false, "int":7, "double":7.7, "string":"ggg", "binary":"ggg", "k1":{"k2":{"k3":{"int":7}}}, "id":7}', '{"int":7, "double":7.7}'),
(8, 8, 8.8, 'hhh', '{"bool":false, "int":8, "double":8.8, "string":"hhh", "binary":"hhh", "k1":{"k2":{"k3":{"int":8}}}, "id":8}', '{"int":8, "double":8.8}'),
(9, 9, 9.9, 'iii', '{"bool":false, "int":9, "double":9.9, "string":"iii", "binary":"iii", "k1":{"k2":{"k3":{"int":9}}}, "id":9}', '{"int":9, "double":9.9}');

analyze table t1;

insert into t2 values
(10, 10, 10.1, 'jjj', '{"bool":false, "int":10, "double":10.1, "string":"jjj", "binary":"jjj", "k1":{"k2":{"k3":{"int":10}}}, "id":10}', '{"int":10, "double":10.1}'),
(11, 11, 11.11, 'kkk', '{"bool":false, "int":11, "double":11.11, "string":"kkk", "binary":"kkk", "k1":{"k2":{"k3":{"int":11}}}, "id":11}', '{"int":11, "double":11.11}'),
(12, 12, 12.12, 'lll', '{"bool":false, "int":12, "double":12.12, "string":"lll", "binary":"lll", "k1":{"k2":{"k3":{"int":12}}}, "id":12}', '{"int":12, "double":12.12}'),
(1, 1, 1.1, 'aaa', '{"bool":true,  "int":1, "double":1.1, "string":"aaa", "binary":"aaa", "k1":{"k2":{"k3":{"int":1}}}, "id":1}', '{"int":1, "double":1.1}'),
(2, 2, 2.2, 'bbb', '{"bool":true,  "int":2, "double":2.2, "string":"bbb", "binary":"bbb", "k1":{"k2":{"k3":{"int":2}}}, "id":2}', '{"int":2, "double":2.2}'),
(3, 3, 3.3, 'ccc', '{"bool":true,  "int":3, "double":3.3, "string":"ccc", "binary":"ccc", "k1":{"k2":{"k3":{"int":3}}}, "id":3}', '{"int":3, "double":3.3}'),
(4, 4, 4.4, 'ddd', '{"bool":true,  "int":4, "double":4.4, "string":"ddd", "binary":"ddd", "k1":{"k2":{"k3":{"int":4}}}, "id":4}', '{"int":4, "double":4.4}'),
(5, 5, 5.5, 'eee', '{"bool":true,  "int":5, "double":5.5, "string":"eee", "binary":"eee", "k1":{"k2":{"k3":{"int":5}}}, "id":5}', '{"int":5, "double":5.5}'),
(6, 6, 6.6, 'fff', '{"bool":false, "int":6, "double":6.6, "string":"fff", "binary":"fff", "k1":{"k2":{"k3":{"int":6}}}, "id":6}', '{"int":6, "double":6.6}'),
(7, 7, 7.7, 'ggg', '{"bool":false, "int":7, "double":7.7, "string":"ggg", "binary":"ggg", "k1":{"k2":{"k3":{"int":7}}}, "id":7}', '{"int":7, "double":7.7}'),
(8, 8, 8.8, 'hhh', '{"bool":false, "int":8, "double":8.8, "string":"hhh", "binary":"hhh", "k1":{"k2":{"k3":{"int":8}}}, "id":8}', '{"int":8, "double":8.8}'),
(9, 9, 9.9, 'iii', '{"bool":false, "int":9, "double":9.9, "string":"iii", "binary":"iii", "k1":{"k2":{"k3":{"int":9}}}, "id":9}', '{"int":9, "double":9.9}');

analyze table t2;

insert into t3 values
(10, 10, 10.1, 'jjj', '{"bool":false, "int":10, "double":10.1, "string":"jjj", "binary":"jjj", "k1":{"k2":{"k3":{"int":10}}}, "id":10}', '{"int":10, "double":10.1}'),
(11, 11, 11.11, 'kkk', '{"bool":false, "int":11, "double":11.11, "string":"kkk", "binary":"kkk", "k1":{"k2":{"k3":{"int":11}}}, "id":11}', '{"int":11, "double":11.11}'),
(12, 12, 12.12, 'lll', '{"bool":false, "int":12, "double":12.12, "string":"lll", "binary":"lll", "k1":{"k2":{"k3":{"int":12}}}, "id":12}', '{"int":12, "double":12.12}'),
(1, 1, 1.1, 'aaa', '{"bool":true,  "int":1, "double":1.1, "string":"aaa", "binary":"aaa", "k1":{"k2":{"k3":{"int":1}}}, "id":1}', '{"int":1, "double":1.1}'),
(2, 2, 2.2, 'bbb', '{"bool":true,  "int":2, "double":2.2, "string":"bbb", "binary":"bbb", "k1":{"k2":{"k3":{"int":2}}}, "id":2}', '{"int":2, "double":2.2}'),
(3, 3, 3.3, 'ccc', '{"bool":true,  "int":3, "double":3.3, "string":"ccc", "binary":"ccc", "k1":{"k2":{"k3":{"int":3}}}, "id":3}', '{"int":3, "double":3.3}'),
(4, 4, 4.4, 'ddd', '{"bool":true,  "int":4, "double":4.4, "string":"ddd", "binary":"ddd", "k1":{"k2":{"k3":{"int":4}}}, "id":4}', '{"int":4, "double":4.4}'),
(5, 5, 5.5, 'eee', '{"bool":true,  "int":5, "double":5.5, "string":"eee", "binary":"eee", "k1":{"k2":{"k3":{"int":5}}}, "id":5}', '{"int":5, "double":5.5}'),
(6, 6, 6.6, 'fff', '{"bool":false, "int":6, "double":6.6, "string":"fff", "binary":"fff", "k1":{"k2":{"k3":{"int":6}}}, "id":6}', '{"int":6, "double":6.6}'),
(7, 7, 7.7, 'ggg', '{"bool":false, "int":7, "double":7.7, "string":"ggg", "binary":"ggg", "k1":{"k2":{"k3":{"int":7}}}, "id":7}', '{"int":7, "double":7.7}'),
(8, 8, 8.8, 'hhh', '{"bool":false, "int":8, "double":8.8, "string":"hhh", "binary":"hhh", "k1":{"k2":{"k3":{"int":8}}}, "id":8}', '{"int":8, "double":8.8}'),
(9, 9, 9.9, 'iii', '{"bool":false, "int":9, "double":9.9, "string":"iii", "binary":"iii", "k1":{"k2":{"k3":{"int":9}}}, "id":9}', '{"int":9, "double":9.9}');

analyze table t3;


################################################################################
###
### ACCESS METHODS EXPLAINED
###

# "select *" on a document table should always be full table scan
explain extended select * from t1 use document keys;
select * from t1 use document keys;

# "select doc" should always be full table scan as well
# (i.e. no covering index on the whole document)
explain extended select doc11 from t1 use document keys;
select doc11 from t1 use document keys;
explain extended select doc12 from t1 use document keys;
select doc12 from t1 use document keys;


################################################################################
###
### Single-table Queries
###

##
## bool index type
##

#
# bool: covering index
#

explain extended select a1 from t1 where doc11.bool is true;
select a1 from t1 where doc11.bool is true;
explain extended select a1 from t1 use document keys where doc11.bool is true;
select a1 from t1 use document keys where doc11.bool is true;

#
# bool: covering index for range queries
#

explain extended select t1.doc11.bool from t1 use document keys where t1.doc11.bool > 0;
select t1.doc11.bool from t1 use document keys where t1.doc11.bool > 0;

explain extended select t1.doc11.bool from t1 use document keys where t1.doc11.bool < 1;
select t1.doc11.bool from t1 use document keys where t1.doc11.bool < 1;

explain extended select t1.doc11.bool from t1 use document keys where t1.doc11.bool > 0 and t1.doc11.bool < 1;
select t1.doc11.bool from t1 use document keys where t1.doc11.bool > 0 and t1.doc11.bool < 1;

explain extended select t1.doc11.bool from t1 use document keys where t1.doc11.bool >= 0;
select t1.doc11.bool from t1 use document keys where t1.doc11.bool >= 0;

explain extended select t1.doc11.bool from t1 use document keys where t1.doc11.bool > 0 and t1.doc11.bool <= 1;
select t1.doc11.bool from t1 use document keys where t1.doc11.bool > 0 and t1.doc11.bool <= 1;

explain extended select t1.doc11.bool from t1 use document keys where t1.doc11.bool between 0 and 1;
select t1.doc11.bool from t1 use document keys where t1.doc11.bool between 0 and 1;

explain extended select t1.doc11.bool from t1 use document keys where t1.doc11.bool not between 0 and 1;
select t1.doc11.bool from t1 use document keys where t1.doc11.bool not between 0 and 1;

explain extended select t1.doc11.bool from t1 use document keys where t1.doc11.bool in (0, 1);
select t1.doc11.bool from t1 use document keys where t1.doc11.bool in (0, 1);

explain extended select t1.doc11.bool from t1 use document keys where t1.doc11.bool in (0);
select t1.doc11.bool from t1 use document keys where t1.doc11.bool in (0);

explain extended select t1.doc11.bool from t1 use document keys where t1.doc11.bool not in (1);
select t1.doc11.bool from t1 use document keys where t1.doc11.bool not in (1);

explain extended select t1.doc11.bool from t1 use document keys
                 where (t1.doc11.bool >= 0 and t1.doc11.bool <= 255) and (t1.doc11.bool not in (0));
select t1.doc11.bool from t1 use document keys
where (t1.doc11.bool >= 0 and t1.doc11.bool <= 255) and (t1.doc11.bool not in (0));

# group by
explain extended select count(a1) from t1 use document keys group by doc11.bool;
select count(a1) from t1 use document keys group by doc11.bool;

explain extended select sum(a1) from t1 use document keys group by doc11.bool;
select sum(a1) from t1 use document keys group by doc11.bool;

explain extended select avg(a1) from t1 use document keys group by doc11.bool;
select avg(a1) from t1 use document keys group by doc11.bool;

explain extended select doc11.bool from t1 where doc11.bool is true;
select doc11.bool from t1 where doc11.bool is true;

explain extended select doc11.bool from t1 use document keys where doc11.bool is true;
select doc11.bool from t1 use document keys where doc11.bool is true;

explain extended select count(doc11.bool) from t1 use document keys group by doc11.bool;
select count(doc11.bool) from t1 use document keys group by doc11.bool;

explain extended select sum(doc11.bool) from t1 use document keys group by doc11.bool;
select sum(doc11.bool) from t1 use document keys group by doc11.bool;

explain extended select avg(doc11.bool) from t1 use document keys group by doc11.bool;
select avg(doc11.bool) from t1 use document keys group by doc11.bool;

# doc_bool is the smallest secondary index to cover primary key

explain extended select a1 from t1;
select a1 from t1;
explain extended select a1 from t1 use document keys;
select a1 from t1 use document keys;

#
# bool: non-covering index for range queries
#

explain extended select * from t1 where doc11.bool is true;
select * from t1 where doc11.bool is true;

explain extended select * from t1 use document keys where doc11.bool is true;
select * from t1 use document keys where doc11.bool is true;

explain extended select t1.doc11.int, t1.doc11.bool from t1 use document keys where t1.doc11.bool > 0;
select t1.doc11.int, t1.doc11.bool from t1 use document keys where t1.doc11.bool > 0;

explain extended select t1.doc11.int, t1.doc11.bool from t1 use document keys where t1.doc11.bool < 1;
select t1.doc11.int, t1.doc11.bool from t1 use document keys where t1.doc11.bool < 1;

explain extended select t1.doc11.int, t1.doc11.bool from t1 use document keys where t1.doc11.bool > 0 and t1.doc11.bool < 1;
select t1.doc11.int, t1.doc11.bool from t1 use document keys where t1.doc11.bool > 0 and t1.doc11.bool < 1;

explain extended select t1.doc11.int, t1.doc11.bool from t1 use document keys where t1.doc11.bool >= 0;
select t1.doc11.int, t1.doc11.bool from t1 use document keys where t1.doc11.bool >= 0;

explain extended select t1.doc11.int, t1.doc11.bool from t1 use document keys where t1.doc11.bool > 0 and t1.doc11.bool <= 1;
select t1.doc11.int, t1.doc11.bool from t1 use document keys where t1.doc11.bool > 0 and t1.doc11.bool <= 1;

explain extended select t1.doc11.int, t1.doc11.bool from t1 use document keys where t1.doc11.bool between 0 and 1;
select t1.doc11.int, t1.doc11.bool from t1 use document keys where t1.doc11.bool between 0 and 1;

explain extended select t1.doc11.int, t1.doc11.bool from t1 use document keys where t1.doc11.bool not between 0 and 1;
select t1.doc11.int, t1.doc11.bool from t1 use document keys where t1.doc11.bool not between 0 and 1;

explain extended select t1.doc11.int, t1.doc11.bool from t1 use document keys where t1.doc11.bool in (0, 1);
select t1.doc11.int, t1.doc11.bool from t1 use document keys where t1.doc11.bool in (0, 1);

explain extended select t1.doc11.int, t1.doc11.bool from t1 use document keys where t1.doc11.bool in (0);
select t1.doc11.int, t1.doc11.bool from t1 use document keys where t1.doc11.bool in (0);

explain extended select t1.doc11.int, t1.doc11.bool from t1 use document keys where t1.doc11.bool not in (1);
select t1.doc11.int, t1.doc11.bool from t1 use document keys where t1.doc11.bool not in (1);

explain extended select t1.doc11.int, t1.doc11.bool from t1 use document keys
                 where (t1.doc11.bool >= 0 and t1.doc11.bool <= 255) and (t1.doc11.bool not in (0));
select t1.doc11.int, t1.doc11.bool from t1 use document keys
where (t1.doc11.bool >= 0 and t1.doc11.bool <= 255) and (t1.doc11.bool not in (0));

# group by

# index scan for count-star
explain extended select count(*) from t1 use document keys group by doc11.bool;
select count(*) from t1 use document keys group by doc11.bool;

explain extended select doc11 from t1 where doc11.bool is true;
select doc11 from t1 where doc11.bool is true;

explain extended select doc11 from t1 use document keys where doc11.bool is true;
select doc11 from t1 use document keys where doc11.bool is true;

explain extended select count(doc11) from t1 use document keys group by doc11.bool;
select count(doc11) from t1 use document keys group by doc11.bool;

explain extended select doc11.int from t1 where doc11.bool is true;
select doc11.int from t1 where doc11.bool is true;

explain extended select doc11.int from t1 use document keys where doc11.bool is true;
select doc11.int from t1 use document keys where doc11.bool is true;

explain extended select count(doc11.int) from t1 use document keys group by doc11.bool;
select count(doc11.int) from t1 use document keys group by doc11.bool;

##
## integer index type
##

#
# int: covering index for range queries
#

# on not-nullable document column
explain extended select a1 from t1 where doc11.int > 5;
select a1 from t1 where doc11.int > 5;

explain extended select a1 from t1 use document keys where doc11.int > 5;
select a1 from t1 use document keys where doc11.int > 5;

explain extended select doc11.int from t1 use document keys where doc11.int >= 5;
select doc11.int from t1 use document keys where doc11.int >= 5;

# out of range
explain extended select a1 from t1 use document keys where doc11.int > 13;
select a1 from t1 use document keys where doc11.int > 13;

explain extended select a1, doc11.int from t1 use document keys where doc11.int < 9;
select a1, doc11.int from t1 use document keys where doc11.int < 9;

explain extended select doc11.int, a1 from t1 use document keys where doc11.int <= 9;
select doc11.int, a1 from t1 use document keys where doc11.int <= 9;

# out of range
explain extended select doc11.int from t1 use document keys where doc11.int < 1;
select doc11.int from t1 use document keys where doc11.int < 1;

explain extended select a1, doc11.int from t1 use document keys where doc11.int > 5 and doc11.int < 9;
select a1, doc11.int from t1 use document keys where doc11.int > 5 and doc11.int < 9;

explain extended select a1 from t1 use document keys where doc11.int >= 5 and doc11.int <= 9;
select a1 from t1 use document keys where doc11.int >= 5 and doc11.int <= 9;

explain extended select a1 from t1 use document keys where doc11.int > 0 and doc11.int < 130;
select a1 from t1 use document keys where doc11.int > 0 and doc11.int < 130;

# between
explain extended select a1, doc11.int from t1 use document keys where doc11.int between 5 and 9;
select a1, doc11.int from t1 use document keys where doc11.int between 5 and 9;

explain extended select doc11.int from t1 use document keys where doc11.int between 5 and 15;
select doc11.int from t1 use document keys where doc11.int between 5 and 15;

# not between
explain extended select a1, doc11.int from t1 use document keys where doc11.int not between 5 and 9;
select a1, doc11.int from t1 use document keys where doc11.int not between 5 and 9;

explain extended select a1, doc11.int from t1 use document keys where doc11.int not between 5 and 130;
select a1, doc11.int from t1 use document keys where doc11.int not between 5 and 130;

# in
explain extended select a1, doc11.int from t1 use document keys where doc11.int in (5, 7, 9, 12);
select a1, doc11.int from t1 use document keys where doc11.int in (5, 7, 9, 12);

explain extended select a1, doc11.int from t1 use document keys where doc11.int in (5, 100, 0);
select a1, doc11.int from t1 use document keys where doc11.int in (5, 100, 0);

# not in
explain extended select a1, doc11.int from t1 use document keys where doc11.int not in (5, 7, 9, 12);
select a1, doc11.int from t1 use document keys where doc11.int not in (5, 7, 9, 12);

explain extended select a1, doc11.int from t1 use document keys where doc11.int not in (0, 100, 5, 6, 7, 12, 11, 10);
select a1, doc11.int from t1 use document keys where doc11.int not in (0, 100, 5, 6, 7, 12, 11, 10);

# multiple ranges without overlap
explain extended select doc11.int from t1 use document keys
where doc11.int > 3 and doc11.int < 5 or doc11.int > 6 and doc11.int < 8 or
      doc11.int > 9 and doc11.int < 11 or doc11.int >= 12 and doc11.int <= 15;

select doc11.int from t1 use document keys
where doc11.int > 3 and doc11.int < 5 or doc11.int > 6 and doc11.int < 8 or
      doc11.int > 9 and doc11.int < 11 or doc11.int >= 12 and doc11.int <= 15;

# multiple ranges with overlap
explain extended select doc11.int from t1 use document keys
where doc11.int > 3 and doc11.int < 8 or doc11.int > 5 and doc11.int < 9 or
      doc11.int > 7 and doc11.int <= 15 or doc11.int >= 12 and doc11.int < 15;

select doc11.int from t1 use document keys
where doc11.int > 3 and doc11.int < 8 or doc11.int > 5 and doc11.int < 9 or
      doc11.int > 7 and doc11.int <= 15 or doc11.int >= 12 and doc11.int < 15;

explain extended select doc11.int from t1 use document keys
where ((doc11.int > 3 and doc11.int < 8) and (doc11.int not between 6 and 9)) or
       ((doc11.int between 11 and 15) and (doc11.int not in (4, 5)));

select doc11.int from t1 use document keys
where ((doc11.int > 3 and doc11.int < 8) and (doc11.int not between 6 and 9)) or
       ((doc11.int between 11 and 15) and (doc11.int not in (4, 5)));

# group by
explain extended select count(a1) from t1 use document keys group by doc11.int having doc11.int > 5;
select count(a1) from t1 use document keys group by doc11.int having doc11.int > 5;

# order by
explain extended select a1 from t1 use document keys order by doc11.int;
select a1 from t1 use document keys order by doc11.int;

explain extended select a1 from t1 use document keys order by doc11.int as string;
select a1 from t1 use document keys order by doc11.int as string;
select a1 from t1 order by doc11.int as string;

explain extended select b1 from t1 use document keys order by doc11.double as string;
select c1 from t1 use document keys order by doc11.double as string;
select c1 from t1 order by doc11.double as string;

explain extended select doc11.int from t1 where doc11.int > 5;
select doc11.int from t1 where doc11.int > 5;
explain extended select doc11.int from t1 use document keys where doc11.int > 5;
select doc11.int from t1 use document keys where doc11.int > 5;

# group by
explain extended select count(doc11.int) from t1 use document keys group by doc11.int having doc11.int > 5 ;
select count(doc11.int) from t1 use document keys group by doc11.int having doc11.int > 5 ;

# group by with where clause
explain extended select count(doc11.int) from t1 use document keys where doc11.int > 5 group by doc11.int;
select count(doc11.int) from t1 use document keys where doc11.int > 5 group by doc11.int;
explain extended select count(a1) from t1 use document keys where doc11.int = 5 group by doc11.int;
select count(a1) from t1 use document keys where doc11.int = 5 group by doc11.int;

# on nullable document column
explain extended select a1 from t1 where doc12.int > 5;
select a1 from t1 where doc12.int > 5;
explain extended select a1 from t1 use document keys where doc12.int > 5;
select a1 from t1 use document keys where doc12.int > 5;

# group by
explain extended select count(a1) from t1 use document keys group by doc12.int having doc12.int > 5;
select count(a1) from t1 use document keys group by doc12.int having doc12.int > 5;

explain extended select doc12.int from t1 where doc12.int > 5;
select doc12.int from t1 where doc12.int > 5;
explain extended select doc12.int from t1 use document keys where doc12.int > 5;
select doc12.int from t1 use document keys where doc12.int > 5;

# group by
explain extended select count(doc12.int) from t1 use document keys group by doc12.int having doc12.int > 5;
select count(doc12.int) from t1 use document keys group by doc12.int having doc12.int > 5;

#
# int: non-covering index for range queries
#

explain extended select doc11.string, doc11.int from t1 use document keys where doc11.int > 5;
select doc11.string, doc11.int from t1 use document keys where doc11.int > 5;

explain extended select doc11.string, doc11.int from t1 use document keys where doc11.int >= 10;
select doc11.string, doc11.int from t1 use document keys where doc11.int >= 10;

# out of range
explain extended select doc11.string, doc11.int from t1 use document keys where doc11.int > 13;
select doc11.string, doc11.int from t1 use document keys where doc11.int > 13;

explain extended select doc11.string, doc11.int from t1 use document keys where doc11.int < 9;
select doc11.string, doc11.int from t1 use document keys where doc11.int < 9;

explain extended select doc11.string, doc11.int from t1 use document keys where doc11.int <= 3;
select doc11.string, doc11.int from t1 use document keys where doc11.int <= 3;

# out of range
explain extended select doc11.string, doc11.int from t1 use document keys where doc11.int < 1;
select doc11.string, doc11.int from t1 use document keys where doc11.int < 1;

explain extended select doc11.string, doc11.int from t1 use document keys where doc11.int > 2 and doc11.int < 12;
select doc11.string, doc11.int from t1 use document keys where doc11.int > 2 and doc11.int < 12;

explain extended select doc11.string, doc11.int from t1 use document keys where doc11.int >= 8 and doc11.int <= 9;
select doc11.string, doc11.int from t1 use document keys where doc11.int >= 8 and doc11.int <= 9;

explain extended select doc11.string, doc11.int from t1 use document keys where doc11.int > 0 and doc11.int < 130;
select doc11.string, doc11.int from t1 use document keys where doc11.int > 0 and doc11.int < 130;

# between
explain extended select doc11.string, doc11.int from t1 use document keys where doc11.int between 8 and 9;
select doc11.string, doc11.int from t1 use document keys where doc11.int between 5 and 9;

explain extended select doc11.string, doc11.int from t1 use document keys where doc11.int between 5 and 15;
select doc11.string, doc11.int from t1 use document keys where doc11.int between 5 and 15;

# not between
explain extended select doc11.string, doc11.int from t1 use document keys where doc11.int not between 8 and 9;
select doc11.string, doc11.int from t1 use document keys where doc11.int not between 8 and 9;

explain extended select doc11.string, doc11.int from t1 use document keys where doc11.int not between 2 and 12;
select doc11.string, doc11.int from t1 use document keys where doc11.int not between 2 and 12;

explain extended select doc11.string, doc11.int from t1 use document keys where doc11.int not between 5 and 130;
select doc11.string, doc11.int from t1 use document keys where doc11.int not between 5 and 130;

# in
explain extended select doc11.string, doc11.int from t1 use document keys where doc11.int in (5);
select doc11.string, doc11.int from t1 use document keys where doc11.int in (5);

explain extended select doc11.string, doc11.int from t1 use document keys where doc11.int in (5, 12);
select doc11.string, doc11.int from t1 use document keys where doc11.int in (5, 12);

explain extended select doc11.string, doc11.int from t1 use document keys where doc11.int in (5, 7, 9, 12);
select doc11.string, doc11.int from t1 use document keys where doc11.int in (5, 7, 9, 12);

explain extended select doc11.string, doc11.int from t1 use document keys where doc11.int in (5, 100, 0);
select doc11.string, doc11.int from t1 use document keys where doc11.int in (5, 100, 0);

# not in
explain extended select doc11.string, doc11.int from t1 use document keys where doc11.int not in (5, 7, 9, 12);
select doc11.string, doc11.int from t1 use document keys where doc11.int not in (5, 7, 9, 12);

explain extended select doc11.string, doc11.int from t1 use document keys where doc11.int not in (0, 100, 5, 6, 7, 12, 11, 10);
select doc11.string, doc11.int from t1 use document keys where doc11.int not in (0, 100, 5, 6, 7, 12, 11, 10);

# multiple ranges without overlap
explain extended select doc11.string, doc11.int from t1 use document keys
where doc11.int > 3 and doc11.int < 5 or doc11.int >= 11 and doc11.int < 100;

select doc11.string, doc11.int from t1 use document keys
where doc11.int > 3 and doc11.int < 5 or doc11.int >= 11 and doc11.int < 100;

explain extended select doc11.string, doc11.int from t1 use document keys
where doc11.int > 3 and doc11.int < 5 or doc11.int > 6 and doc11.int < 8 or
      doc11.int > 9 and doc11.int < 11 or doc11.int >= 12 and doc11.int <= 15;

select doc11.string, doc11.int from t1 use document keys
where doc11.int > 3 and doc11.int < 5 or doc11.int > 6 and doc11.int < 8 or
      doc11.int > 9 and doc11.int < 11 or doc11.int >= 12 and doc11.int <= 15;

# multiple ranges with overlap
explain extended select doc11.string, doc11.int from t1 use document keys
where doc11.int > 3 and doc11.int < 8 or doc11.int > 5 and doc11.int < 9 or
      doc11.int > 7 and doc11.int <= 15 or doc11.int >= 12 and doc11.int < 15;

select doc11.string, doc11.int from t1 use document keys
where doc11.int > 3 and doc11.int < 8 or doc11.int > 5 and doc11.int < 9 or
      doc11.int > 7 and doc11.int <= 15 or doc11.int >= 12 and doc11.int < 15;

explain extended select doc11.string, doc11.int from t1 use document keys
where ((doc11.int > 3 and doc11.int < 8) and (doc11.int not between 6 and 9)) or
       ((doc11.int between 11 and 15) and (doc11.int not in (4, 5)));

select doc11.string, doc11.int from t1 use document keys
where ((doc11.int > 3 and doc11.int < 8) and (doc11.int not between 6 and 9)) or
       ((doc11.int between 11 and 15) and (doc11.int not in (4, 5)));

# select path is a prefix of the indexed document path
explain extended select doc11.k1.k2 from t1 where doc11.k1.k2.k3.int > 11;
select doc11.k1.k2 from t1 where doc11.k1.k2.k3.int > 11;

explain extended select doc11.k1.k2 from t1 use document keys where doc11.k1.k2.k3.int > 11;
select doc11.k1.k2 from t1 use document keys where doc11.k1.k2.k3.int > 11;
select doc11.k1.k2.k3 from t1 use document keys where doc11.k1.k2.k3.int > 11;
select doc11.k1.k2.k3.int.foo from t1 use document keys where doc11.k1.k2.k3.int > 11;

# where condition is a prefix of the indexed document path
explain extended select doc11.k1.k2.k3.int from t1 use document keys where doc11.k1.k2.k3 > 11;
select doc11.k1.k2.k3.int from t1 use document keys where doc11.k1.k2.k3 > 11;

#
# int: non-covering index for range queries with group by / order by
#

# group by with having
--echo FIXME!!
explain extended select count(*) from t1 use document keys group by doc11.int having doc11.int > 5;
select count(*) from t1 use document keys group by doc11.int having doc11.int > 5;

--echo FIXME!!
explain extended select count(doc11) from t1 use document keys group by doc11.int having doc11.int > 5;
select count(doc11) from t1 use document keys group by doc11.int having doc11.int > 5;

--echo FIXME!!
explain extended select sum(doc11.double) from t1 use document keys group by doc11.int having doc11.int > 5;
select sum(doc11.double) from t1 use document keys group by doc11.int having doc11.int > 5;

# group by with having on nullable document column
--echo FIXME!!
explain extended select count(*) from t1 use document keys group by doc12.int having doc12.int > 5;
select count(*) from t1 use document keys group by doc12.int having doc12.int > 5;

--echo FIXME!!
explain extended select count(doc12) from t1 use document keys group by doc12.int having doc12.int > 5;
select count(doc12) from t1 use document keys group by doc12.int having doc12.int > 5;

--echo FIXME!!
explain extended select sum(doc12.double) from t1 use document keys group by doc12.int having doc12.int > 5;
select sum(doc12.double) from t1 use document keys group by doc12.int having doc12.int > 5;

##
## double index type
##

#
# double: covering index
#

# on not-nullable document column
explain extended select a1 from t1 where doc11.double > 5.5;
select a1 from t1 where doc11.double > 5.5;
explain extended select a1 from t1 use document keys where doc11.double > 5.5;
select a1 from t1 use document keys where doc11.double > 5.5;

# group by
explain extended select sum(a1) from t1 use document keys group by doc11.double having doc11.double > 5.5;
select sum(a1) from t1 use document keys group by doc11.double having doc11.double > 5.5;

explain extended select doc11.double from t1 where doc11.double > 5.5;
select doc11.double from t1 where doc11.double > 5.5;
explain extended select doc11.double from t1 use document keys where doc11.double > 5.5;
select doc11.double from t1 use document keys where doc11.double > 5.5;

# group by
explain extended select sum(doc11.double) from t1 use document keys group by doc11.double having doc11.double > 5.5;
select sum(doc11.double) from t1 use document keys group by doc11.double having doc11.double > 5.5;

# on nullable document column
explain extended select a1 from t1 where doc12.double > 5.5;
select a1 from t1 where doc12.double > 5.5;
explain extended select a1 from t1 use document keys where doc12.double > 5.5;
select a1 from t1 use document keys where doc12.double > 5.5;
# group by
explain extended select count(a1) from t1 use document keys group by doc12.double having doc12.double > 5.5;
select count(a1) from t1 use document keys group by doc12.double having doc12.double > 5.5;

explain extended select doc12.double from t1 where doc12.double > 5.5;
select doc12.double from t1 where doc12.double > 5.5;
explain extended select doc12.double from t1 use document keys where doc12.double > 5.5;
select doc12.double from t1 use document keys where doc12.double > 5.5;
# group by
explain extended select count(doc12.double) from t1 use document keys group by doc12.double having doc12.double > 5.5;
select count(doc12.double) from t1 use document keys group by doc12.double having doc12.double > 5.5;

#
# double: covering index for range queries
#

# on not-nullable document column
explain extended select a1 from t1 where doc11.double > 5.5;
select a1 from t1 where doc11.double > 5.5;

explain extended select a1 from t1 use document keys where doc11.double > 5.5;
select a1 from t1 use document keys where doc11.double > 5.5;

explain extended select doc11.double from t1 use document keys where doc11.double >= 5.5;
select doc11.double from t1 use document keys where doc11.double >= 5.5;

# out of range
explain extended select a1 from t1 use document keys where doc11.double > 13.3;
select a1 from t1 use document keys where doc11.double > 13.3;

explain extended select a1, doc11.double from t1 use document keys where doc11.double < 9.9;
select a1, doc11.double from t1 use document keys where doc11.double < 9.9;

explain extended select doc11.double, a1 from t1 use document keys where doc11.double <= 9.9;
select doc11.double, a1 from t1 use document keys where doc11.double <= 9.9;

# out of range
explain extended select doc11.double from t1 use document keys where doc11.double < 0.1;
select doc11.double from t1 use document keys where doc11.double < 0.1;

explain extended select a1, doc11.double from t1 use document keys where doc11.double > 5.5 and doc11.double < 9.9;
select a1, doc11.double from t1 use document keys where doc11.double > 5.5 and doc11.double < 9.9;

explain extended select a1 from t1 use document keys where doc11.double >= 5.5 and doc11.double <= 9.9;
select a1 from t1 use document keys where doc11.double >= 5.5 and doc11.double <= 9.9;

explain extended select a1 from t1 use document keys where doc11.double > 0 and doc11.double < 130;
select a1 from t1 use document keys where doc11.double > 0 and doc11.double < 130;

# between
explain extended select a1, doc11.double from t1 use document keys where doc11.double between 5.5 and 9.9;
select a1, doc11.double from t1 use document keys where doc11.double between 5.5 and 9.9;

explain extended select doc11.double from t1 use document keys where doc11.double between 5.5 and 15.5;
select doc11.double from t1 use document keys where doc11.double between 5.5 and 15.5;

# not between
explain extended select a1, doc11.double from t1 use document keys where doc11.double not between 5.5 and 9.9;
select a1, doc11.double from t1 use document keys where doc11.double not between 5.5 and 9.9;

explain extended select a1, doc11.double from t1 use document keys where doc11.double not between 5.5 and 130;
select a1, doc11.double from t1 use document keys where doc11.double not between 5.5 and 130;

# in
explain extended select a1, doc11.double from t1 use document keys where doc11.double in (5.5, 7.7, 9.9, 12.12);
select a1, doc11.double from t1 use document keys where doc11.double in (5.5, 7.7, 9.9, 12.12);

explain extended select a1, doc11.double from t1 use document keys where doc11.double in (5.5, 100, 0);
select a1, doc11.double from t1 use document keys where doc11.double in (5.5, 100, 0);

# not in
explain extended select a1, doc11.double from t1 use document keys where doc11.double not in (5.5, 7.7, 9.9, 12.12);
select a1, doc11.double from t1 use document keys where doc11.double not in (5.5, 7.7, 9.9, 12.12);

explain extended select a1, doc11.double from t1 use document keys where doc11.double not in (0, 100, 5.5, 6.6, 7.7, 12.12, 11.11, 10.1);
select a1, doc11.double from t1 use document keys where doc11.double not in (0, 100, 5.5, 6.6, 7.7, 12.12, 11.11, 10.1);

# multiple ranges without overlap
explain extended select doc11.double from t1 use document keys
where doc11.double > 3.3 and doc11.double < 5.5 or doc11.double > 6.6 and doc11.double < 8.8 or
      doc11.double > 9.9 and doc11.double < 11.11 or doc11.double >= 12.12 and doc11.double <= 15.15;

select doc11.double from t1 use document keys
where doc11.double > 3.3 and doc11.double < 5.5 or doc11.double > 6.6 and doc11.double < 8.8 or
      doc11.double > 9.9 and doc11.double < 11.11 or doc11.double >= 12.12 and doc11.double <= 15.15;

# multiple ranges with overlap
explain extended select doc11.double from t1 use document keys
where doc11.double > 3.3 and doc11.double < 8.8 or doc11.double > 5.5 and doc11.double < 9.9 or
      doc11.double > 7.7 and doc11.double <= 15.15 or doc11.double >= 12.12 and doc11.double < 15.15;

select doc11.double from t1 use document keys
where doc11.double > 3.3 and doc11.double < 8.8 or doc11.double > 5.5 and doc11.double < 9.9 or
      doc11.double > 7.7 and doc11.double <= 15.15 or doc11.double >= 12.12 and doc11.double < 15.15;

explain extended select doc11.double from t1 use document keys
where ((doc11.double > 3.3 and doc11.double < 8.8) and (doc11.double not between 6.6 and 9.9)) or
       ((doc11.double between 11.11 and 15.15) and (doc11.double not in (4.4, 5.5)));

select doc11.double from t1 use document keys
where ((doc11.double > 3.3 and doc11.double < 8.8) and (doc11.double not between 6.6 and 9.9)) or
       ((doc11.double between 11.11 and 15.15) and (doc11.double not in (4.4, 5.5)));

#
# double: non-covering index for range queries
#

# on not-nullable document column
explain extended select a1, doc11.int from t1 where doc11.double > 5.5;
select a1, doc11.int from t1 where doc11.double > 5.5;

explain extended select a1, doc11.int from t1 use document keys where doc11.double > 5.5;
select a1, doc11.int from t1 use document keys where doc11.double > 5.5;

explain extended select doc11.double, doc11.int from t1 use document keys where doc11.double >= 5.5;
select doc11.double, doc11.int from t1 use document keys where doc11.double >= 5.5;

# out of range
explain extended select a1, doc11.int from t1 use document keys where doc11.double > 13.3;
select a1, doc11.int from t1 use document keys where doc11.double > 13.3;

explain extended select a1, doc11.double, doc11.int from t1 use document keys where doc11.double < 9.9;
select a1, doc11.double, doc11.int from t1 use document keys where doc11.double < 9.9;

explain extended select doc11.double, a1, doc11.int from t1 use document keys where doc11.double <= 9.9;
select doc11.double, a1, doc11.int from t1 use document keys where doc11.double <= 9.9;

# out of range
explain extended select doc11.double, doc11.int from t1 use document keys where doc11.double < 0.1;
select doc11.double, doc11.int from t1 use document keys where doc11.double < 0.1;

explain extended select a1, doc11.double, doc11.int from t1 use document keys where doc11.double > 5.5 and doc11.double < 9.9;
select a1, doc11.double, doc11.int from t1 use document keys where doc11.double > 5.5 and doc11.double < 9.9;

explain extended select a1, doc11.int from t1 use document keys where doc11.double >= 5.5 and doc11.double <= 9.9;
select a1, doc11.int from t1 use document keys where doc11.double >= 5.5 and doc11.double <= 9.9;

explain extended select a1, doc11.int from t1 use document keys where doc11.double > 0 and doc11.double < 130;
select a1, doc11.int from t1 use document keys where doc11.double > 0 and doc11.double < 130;

# between
explain extended select a1, doc11.double, doc11.int from t1 use document keys where doc11.double between 5.5 and 9.9;
select a1, doc11.double, doc11.int from t1 use document keys where doc11.double between 5.5 and 9.9;

explain extended select doc11.double, doc11.int from t1 use document keys where doc11.double between 5.5 and 15.5;
select doc11.double, doc11.int from t1 use document keys where doc11.double between 5.5 and 15.5;

# not between
explain extended select a1, doc11.double, doc11.int from t1 use document keys where doc11.double not between 5.5 and 9.9;
select a1, doc11.double, doc11.int from t1 use document keys where doc11.double not between 5.5 and 9.9;

explain extended select a1, doc11.double, doc11.int from t1 use document keys where doc11.double not between 5.5 and 130;
select a1, doc11.double, doc11.int from t1 use document keys where doc11.double not between 5.5 and 130;

# in
explain extended select a1, doc11.double, doc11.int from t1 use document keys where doc11.double in (5.5, 7.7, 9.9, 12.12);
select a1, doc11.double, doc11.int from t1 use document keys where doc11.double in (5.5, 7.7, 9.9, 12.12);

explain extended select a1, doc11.double, doc11.int from t1 use document keys where doc11.double in (5.5, 100, 0);
select a1, doc11.double, doc11.int from t1 use document keys where doc11.double in (5.5, 100, 0);

# not in
explain extended select a1, doc11.double, doc11.int from t1 use document keys where doc11.double not in (5.5, 7.7, 9.9, 12.12);
select a1, doc11.double, doc11.int from t1 use document keys where doc11.double not in (5.5, 7.7, 9.9, 12.12);

explain extended select a1, doc11.double, doc11.int from t1 use document keys where doc11.double not in (0, 100, 5.5, 6.6, 7.7, 12.12, 11.11, 10.1);
select a1, doc11.double, doc11.int from t1 use document keys where doc11.double not in (0, 100, 5.5, 6.6, 7.7, 12.12, 11.11, 10.1);

# multiple ranges without overlap
explain extended select doc11.double, doc11.int from t1 use document keys
where doc11.double > 3.3 and doc11.double < 5.5 or doc11.double > 6.6 and doc11.double < 8.8 or
      doc11.double > 9.9 and doc11.double < 11.11 or doc11.double >= 12.12 and doc11.double <= 15.15;

select doc11.double, doc11.int from t1 use document keys
where doc11.double > 3.3 and doc11.double < 5.5 or doc11.double > 6.6 and doc11.double < 8.8 or
      doc11.double > 9.9 and doc11.double < 11.11 or doc11.double >= 12.12 and doc11.double <= 15.15;

# multiple ranges with overlap
explain extended select doc11.double, doc11.int from t1 use document keys
where doc11.double > 3.3 and doc11.double < 8.8 or doc11.double > 5.5 and doc11.double < 9.9 or
      doc11.double > 7.7 and doc11.double <= 15.15 or doc11.double >= 12.12 and doc11.double < 15.15;

select doc11.double, doc11.int from t1 use document keys
where doc11.double > 3.3 and doc11.double < 8.8 or doc11.double > 5.5 and doc11.double < 9.9 or
      doc11.double > 7.7 and doc11.double <= 15.15 or doc11.double >= 12.12 and doc11.double < 15.15;

explain extended select doc11.double, doc11.int from t1 use document keys
where ((doc11.double > 3.3 and doc11.double < 8.8) and (doc11.double not between 6.6 and 9.9)) or
       ((doc11.double between 11.11 and 15.15) and (doc11.double not in (4.4, 5.5)));

select doc11.double, doc11.int from t1 use document keys
where ((doc11.double > 3.3 and doc11.double < 8.8) and (doc11.double not between 6.6 and 9.9)) or
       ((doc11.double between 11.11 and 15.15) and (doc11.double not in (4.4, 5.5)));

#
# double: non-covering index for range queries with aggregations
#

# on not-nullable document column
explain extended select * from t1 where doc11.double > 5.5;
select * from t1 where doc11.double > 5.5;

explain extended select * from t1 use document keys where doc11.double > 5.5;
select * from t1 use document keys where doc11.double > 5.5;

# group by
explain extended select count(*) from t1 use document keys group by doc11.double having doc11.double > 5.5;
select count(*) from t1 use document keys group by doc11.double having doc11.double > 5.5;

explain extended select doc11 from t1 where doc11.double > 5.5;
select doc11 from t1 where doc11.double > 5.5;

explain extended select doc11 from t1 use document keys where doc11.double > 5.5;
select doc11 from t1 use document keys where doc11.double > 5.5;

# group by
explain extended select count(doc11) from t1 use document keys group by doc11.double having doc11.double > 5.5;
select count(doc11) from t1 use document keys group by doc11.double having doc11.double > 5.5;

explain extended select doc11.string from t1 where doc11.double > 5.5;
select doc11.string from t1 where doc11.double > 5.5;

explain extended select doc11.string from t1 use document keys where doc11.double > 5.5;
select doc11.string from t1 use document keys where doc11.double > 5.5;

# group by
explain extended select count(doc11.string) from t1 use document keys group by doc11.double having doc11.double > 5.5;
select count(doc11.string) from t1 use document keys group by doc11.double having doc11.double > 5.5;

# on nullable document column
explain extended select * from t1 where doc12.double > 5.5;
select * from t1 where doc12.double > 5.5;

explain extended select * from t1 use document keys where doc12.double > 5.5;
select * from t1 use document keys where doc12.double > 5.5;

# group by
explain extended select count(*) from t1 use document keys group by doc12.double having doc12.double > 5.5;
select count(*) from t1 use document keys group by doc12.double having doc12.double > 5.5;

explain extended select doc12 from t1 where doc12.double > 5.5;
select doc12 from t1 where doc12.double > 5.5;

explain extended select doc12 from t1 use document keys where doc12.double > 5.5;
select doc12 from t1 use document keys where doc12.double > 5.5;

# group by
explain extended select count(doc12) from t1 use document keys group by doc12.double having doc12.double > 5.5;
select count(doc12) from t1 use document keys group by doc12.double having doc12.double > 5.5;

explain extended select doc12.int from t1 where doc12.double > 5.5;
select doc12.int from t1 where doc12.double > 5.5;

explain extended select doc12.int from t1 use document keys where doc12.double > 5.5;
select doc12.int from t1 use document keys where doc12.double > 5.5;

# group by
explain extended select count(doc12.int) from t1 use document keys group by doc12.double having doc12.double > 5.5;
select count(doc12.int) from t1 use document keys group by doc12.double having doc12.double > 5.5;

##
## string index type
##

#
# string: covering index
#

explain extended select a1 from t1 where doc11.string = 'eee';
select a1 from t1 where doc11.string = 'eee';
explain extended select a1 from t1 use document keys where doc11.string = 'eee';
select a1 from t1 use document keys where doc11.string = 'eee';
# group by string will not be covered by prefix indexes
explain extended select count(a1) from t1 use document keys group by doc11.string having doc11.string = 'eee';
select count(a1) from t1 use document keys group by doc11.string having doc11.string = 'eee';

explain extended select doc11.string from t1 where doc11.string = 'eee';
select doc11.string from t1 where doc11.string = 'eee';
explain extended select doc11.string from t1 use document keys where doc11.string = 'eee';
select doc11.string from t1 use document keys where doc11.string = 'eee';
# group by string will not be covered by prefix indexes
explain extended select count(doc11.string) from t1 use document keys group by doc11.string having doc11.string = 'eee';
select count(doc11.string) from t1 use document keys group by doc11.string having doc11.string = 'eee';

#
# string: non-covering
#

explain extended select * from t1 where doc11.string = 'eee';
select * from t1 where doc11.string = 'eee';
explain extended select * from t1 use document keys where doc11.string = 'eee';
select * from t1 use document keys where doc11.string = 'eee';
# group by
explain extended select count(*) from t1 use document keys group by doc11.string having doc11.string = 'eee';
select count(*) from t1 use document keys group by doc11.string having doc11.string = 'eee';

explain extended select doc11 from t1 where doc11.string = 'eee';
select doc11 from t1 where doc11.string = 'eee';
explain extended select doc11 from t1 use document keys where doc11.string = 'eee';
select doc11 from t1 use document keys where doc11.string = 'eee';
# group by
explain extended select count(doc11) from t1 use document keys group by doc11.string having doc11.string = 'eee';
select count(doc11) from t1 use document keys group by doc11.string having doc11.string = 'eee';

explain extended select doc11.int from t1 where doc11.string = 'eee';
select doc11.int from t1 where doc11.string = 'eee';
explain extended select doc11.int from t1 use document keys where doc11.string = 'eee';
select doc11.int from t1 use document keys where doc11.string = 'eee';
# group by
explain extended select sum(doc11.int) from t1 use document keys group by doc11.string having doc11.string = 'eee';
select sum(doc11.int) from t1 use document keys group by doc11.string having doc11.string = 'eee';

#
# string: pattern match for string index key
#

explain extended select a1 from t1 where doc11.string like 'e%';
select a1 from t1 where doc11.string like 'e%';
explain extended select a1 from t1 use document keys where doc11.string like 'e%';
select a1 from t1 use document keys where doc11.string like 'e%';

explain extended select doc11.string from t1 where doc11.string like 'e%';
select doc11.string from t1 where doc11.string like 'e%';
explain extended select doc11.string from t1 use document keys where doc11.string like 'e%';
select doc11.string from t1 use document keys where doc11.string like 'e%';

explain extended select * from t1 where doc11.string like 'e%';
select * from t1 where doc11.string like 'e%';
explain extended select * from t1 use document keys where doc11.string like 'e%';
select * from t1 use document keys where doc11.string like 'e%';

explain extended select doc11 from t1 where doc11.string like 'e%';
select doc11 from t1 where doc11.string like 'e%';
explain extended select doc11 from t1 use document keys where doc11.string like 'e%';
select doc11 from t1 use document keys where doc11.string like 'e%';

explain extended select doc11.int from t1 where doc11.string like 'e%';
select doc11.int from t1 where doc11.string like 'e%';
explain extended select doc11.int from t1 use document keys where doc11.string like 'e%';
select doc11.int from t1 use document keys where doc11.string like 'e%';

#
# string: covering index for range queries
#

# on not-nullable document column
explain extended select a1 from t1 where doc11.string > 'eee';
select a1 from t1 where doc11.string > 'eee';

explain extended select a1 from t1 use document keys where doc11.string > 'eee';
select a1 from t1 use document keys where doc11.string > 'eee';

explain extended select doc11.string from t1 use document keys where doc11.string >= 'kkk';
select doc11.string from t1 use document keys where doc11.string >= 'kkk';

# out of range
explain extended select a1 from t1 use document keys where doc11.string > 'zzz';
select a1 from t1 use document keys where doc11.string > 'zzz';

explain extended select a1, doc11.string from t1 use document keys where doc11.string < 'iii';
select a1, doc11.string from t1 use document keys where doc11.string < 'iii';

explain extended select doc11.string, a1 from t1 use document keys where doc11.string <= 'iii';
select doc11.string, a1 from t1 use document keys where doc11.string <= 'iii';

# out of range
explain extended select doc11.string from t1 use document keys where doc11.string < 'aaa';
select doc11.double from t1 use document keys where doc11.string < 'aaa';

explain extended select a1, doc11.string from t1 use document keys where doc11.string > 'eee' and doc11.string < 'iii';
select a1, doc11.string from t1 use document keys where doc11.string > 'eee' and doc11.string < 'iii';

explain extended select a1 from t1 use document keys where doc11.string >= 'eee' and doc11.string <= 'iii';
select a1 from t1 use document keys where doc11.string >= 'eee' and doc11.string <= 'iii';

explain extended select a1 from t1 use document keys where doc11.string > '' and doc11.string < 'zzz';
select a1 from t1 use document keys where doc11.string > '' and doc11.string < 'zzz';

# between
explain extended select a1, doc11.string from t1 use document keys where doc11.string between 'eee' and 'iii';
select a1, doc11.string from t1 use document keys where doc11.string between 'eee' and 'iii';

explain extended select doc11.string from t1 use document keys where doc11.string between 'eee' and 'zzz';
select doc11.string from t1 use document keys where doc11.string between 'eee' and 'zzz';

# not between
explain extended select a1, doc11.string from t1 use document keys where doc11.string not between 'eee' and 'iii';
select a1, doc11.string from t1 use document keys where doc11.string not between 'eee' and 'iii';

explain extended select a1, doc11.string from t1 use document keys where doc11.string not between 'eee' and 'zzz';
select a1, doc11.string from t1 use document keys where doc11.string not between 'eee' and 'zzz';

# in
explain extended select a1, doc11.string from t1 use document keys where doc11.string in ('eee', 'ggg', 'iii', 'lll');
select a1, doc11.string from t1 use document keys where doc11.string in ('eee', 'ggg', 'iii', 'lll');

explain extended select a1, doc11.string from t1 use document keys where doc11.string in ('eee', 'zzz', '');
select a1, doc11.string from t1 use document keys where doc11.string in ('eee', 'zzz', '');

# not in
explain extended select a1, doc11.string from t1 use document keys where doc11.string not in ('eee', 'ggg', 'iii', 'lll');
select a1, doc11.string from t1 use document keys where doc11.string not in ('eee', 'ggg', 'iii', 'lll');

explain extended select a1, doc11.string from t1 use document keys where doc11.string not in ('', 'zzz', 'eee', 'fff', 'ggg', 'lll', 'iii', 'hhh');
select a1, doc11.string from t1 use document keys where doc11.string not in ('', 'zzz', 'eee', 'fff', 'ggg', 'lll', 'iii', 'hhh');

# multiple ranges without overlap
explain extended select doc11.string from t1 use document keys
where doc11.string > 'ccc' and doc11.string < 'fff' or doc11.string > 'ggg' and doc11.string < 'hhh' or
      doc11.string > 'iii' and doc11.string < 'kkk' or doc11.string >= 'lll' and doc11.string <= 'zzz';

select doc11.string from t1 use document keys
where doc11.string > 'ccc' and doc11.string < 'fff' or doc11.string > 'ggg' and doc11.string < 'hhh' or
      doc11.string > 'iii' and doc11.string < 'kkk' or doc11.string >= 'lll' and doc11.string <= 'zzz';

# multiple ranges with overlap
explain extended select doc11.string from t1 use document keys
where doc11.string > 'ccc' and doc11.string < 'hhh' or doc11.string > 'fff' and doc11.string < 'iii' or
      doc11.string > 'ggg' and doc11.string <= 'zzz' or doc11.string >= 'lll' and doc11.string < 'zzz';

select doc11.string from t1 use document keys
where doc11.string > 'ccc' and doc11.string < 'hhh' or doc11.string > 'fff' and doc11.string < 'iii' or
      doc11.string > 'ggg' and doc11.string <= 'zzz' or doc11.string >= 'lll' and doc11.string < 'zzz';

explain extended select doc11.string from t1 use document keys
where ((doc11.string > 'ccc' and doc11.string < 'hhh') and (doc11.string not between 'ggg' and 'iii')) or
       ((doc11.string between 'kkk' and 'zzz') and (doc11.string not in ('ddd', 'eee')));

select doc11.string from t1 use document keys
where ((doc11.string > 'ccc' and doc11.string < 'hhh') and (doc11.string not between 'ggg' and 'iii')) or
       ((doc11.string between 'kkk' and 'zzz') and (doc11.string not in ('ddd', 'eee')));

#
# string: non-covering index for range queries
#

# on not-nullable document column
explain extended select a1, doc11.int from t1 where doc11.string > 'eee';
select a1, doc11.int from t1 where doc11.string > 'eee';

explain extended select a1, doc11.int from t1 use document keys where doc11.string > 'eee';
select a1, doc11.int from t1 use document keys where doc11.string > 'eee';

explain extended select doc11.string, doc11.int from t1 use document keys where doc11.string >= 'kkk';
select doc11.string, doc11.int from t1 use document keys where doc11.string >= 'kkk';

# out of range
explain extended select a1, doc11.int from t1 use document keys where doc11.string > 'zzz';
select a1, doc11.int from t1 use document keys where doc11.string > 'zzz';

explain extended select a1, doc11.string, doc11.int from t1 use document keys where doc11.string < 'iii';
select a1, doc11.string, doc11.int from t1 use document keys where doc11.string < 'iii';

explain extended select doc11.string, a1, doc11.int from t1 use document keys where doc11.string <= 'iii';
select doc11.string, a1, doc11.int from t1 use document keys where doc11.string <= 'iii';

# out of range
explain extended select doc11.string, doc11.int from t1 use document keys where doc11.string < 'aaa';
select doc11.string, doc11.int from t1 use document keys where doc11.string < 'aaa';

explain extended select a1, doc11.string, doc11.int from t1 use document keys where doc11.string > 'eee' and doc11.string < 'iii';
select a1, doc11.string, doc11.int from t1 use document keys where doc11.string > 'eee' and doc11.string < 'iii';

explain extended select a1, doc11.int from t1 use document keys where doc11.string >= 'eee' and doc11.string <= 'iii';
select a1, doc11.int from t1 use document keys where doc11.string >= 'eee' and doc11.string <= 'iii';

explain extended select a1, doc11.int from t1 use document keys where doc11.string > '' and doc11.string < 'zzz';
select a1, doc11.int from t1 use document keys where doc11.string > '' and doc11.string < 'zzz';

# between
explain extended select a1, doc11.string, doc11.int from t1 use document keys where doc11.string between 'eee' and 'iii';
select a1, doc11.string, doc11.int from t1 use document keys where doc11.string between 'eee' and 'iii';

explain extended select doc11.string, doc11.int from t1 use document keys where doc11.string between 'eee' and 'zzz';
select doc11.string, doc11.int from t1 use document keys where doc11.string between 'eee' and 'zzz';

# not between
explain extended select a1, doc11.string, doc11.int from t1 use document keys where doc11.string not between 'eee' and 'iii';
select a1, doc11.string, doc11.int from t1 use document keys where doc11.string not between 'eee' and 'iii';

explain extended select a1, doc11.string, doc11.int from t1 use document keys where doc11.string not between 'eee' and 'zzz';
select a1, doc11.string, doc11.int from t1 use document keys where doc11.string not between 'eee' and 'zzz';

# in
explain extended select a1, doc11.string, doc11.int from t1 use document keys where doc11.string in ('eee', 'ggg', 'iii', 'lll');
select a1, doc11.string, doc11.int from t1 use document keys where doc11.string in ('eee', 'ggg', 'iii', 'lll');

explain extended select a1, doc11.string, doc11.int from t1 use document keys where doc11.string in ('eee', 'zzz', '');
select a1, doc11.string, doc11.int from t1 use document keys where doc11.string in ('eee', 'zzz', '');

# not in
explain extended select a1, doc11.string, doc11.int from t1 use document keys where doc11.string not in ('eee', 'ggg', 'iii', 'lll');
select a1, doc11.string, doc11.int from t1 use document keys where doc11.string not in ('eee', 'ggg', 'iii', 'lll');

explain extended select a1, doc11.string, doc11.int from t1 use document keys where doc11.string not in ('', 'zzz', 'eee', 'fff', 'ggg', 'lll', 'iii', 'hhh');
select a1, doc11.string, doc11.int from t1 use document keys where doc11.string not in ('', 'zzz', 'eee', 'fff', 'ggg', 'lll', 'iii', 'hhh');

# multiple ranges without overlap
explain extended select doc11.string, doc11.int from t1 use document keys
where doc11.string > 'ccc' and doc11.string < 'fff' or doc11.string > 'ggg' and doc11.string < 'hhh' or
      doc11.string > 'iii' and doc11.string < 'kkk' or doc11.string >= 'lll' and doc11.string <= 'zzz';

select doc11.string, doc11.int from t1 use document keys
where doc11.string > 'ccc' and doc11.string < 'fff' or doc11.string > 'ggg' and doc11.string < 'hhh' or
      doc11.string > 'iii' and doc11.string < 'kkk' or doc11.string >= 'lll' and doc11.string <= 'zzz';

# multiple ranges with overlap
explain extended select doc11.string, doc11.int from t1 use document keys
where doc11.string > 'ccc' and doc11.string < 'hhh' or doc11.string > 'fff' and doc11.string < 'iii' or
      doc11.string > 'ggg' and doc11.string <= 'zzz' or doc11.string >= 'lll' and doc11.string < 'zzz';

select doc11.string, doc11.int from t1 use document keys
where doc11.string > 'ccc' and doc11.string < 'hhh' or doc11.string > 'fff' and doc11.string < 'iii' or
      doc11.string > 'ggg' and doc11.string <= 'zzz' or doc11.string >= 'lll' and doc11.string < 'zzz';

explain extended select doc11.string, doc11.int from t1 use document keys
where ((doc11.string > 'ccc' and doc11.string < 'hhh') and (doc11.string not between 'ggg' and 'iii')) or
       ((doc11.string between 'kkk' and 'zzz') and (doc11.string not in ('ddd', 'eee')));

select doc11.string, doc11.int from t1 use document keys
where ((doc11.string > 'ccc' and doc11.string < 'hhh') and (doc11.string not between 'ggg' and 'iii')) or
       ((doc11.string between 'kkk' and 'zzz') and (doc11.string not in ('ddd', 'eee')));

##
## binary index type
##

#
# binary: covering binary index
#

explain extended select a1 from t1 where doc11.binary = 'eee';
select a1 from t1 where doc11.binary = 'eee';
explain extended select a1 from t1 use document keys where doc11.binary = 'eee';
select a1 from t1 use document keys where doc11.binary = 'eee';

explain extended select doc11.binary from t1 where doc11.binary = 'eee';
select doc11.binary from t1 where doc11.binary = 'eee';
explain extended select doc11.binary from t1 use document keys where doc11.binary = 'eee';
select doc11.binary from t1 use document keys where doc11.binary = 'eee';

#
# binary: non-covering
#

explain extended select * from t1 where doc11.binary = 'eee';
select * from t1 where doc11.binary = 'eee';
explain extended select * from t1 use document keys where doc11.binary = 'eee';
select * from t1 use document keys where doc11.binary = 'eee';

explain extended select doc11 from t1 where doc11.binary = 'eee';
select doc11 from t1 where doc11.binary = 'eee';
explain extended select doc11 from t1 use document keys where doc11.binary = 'eee';
select doc11 from t1 use document keys where doc11.binary = 'eee';

explain extended select doc11.int from t1 where doc11.binary = 'eee';
select doc11.int from t1 where doc11.binary = 'eee';
explain extended select doc11.int from t1 use document keys where doc11.binary = 'eee';
select doc11.int from t1 use document keys where doc11.binary = 'eee';

#
# TODO: pattern matching is not supported on prefix index scan
#

explain extended select a1 from t1 where doc11.binary like 'e%';
select a1 from t1 where doc11.binary like 'e%';
explain extended select a1 from t1 use document keys where doc11.binary like 'e%';
select a1 from t1 use document keys where doc11.binary like 'e%';

explain extended select doc11.binary from t1 where doc11.binary like 'e%';
select doc11.binary from t1 where doc11.binary like 'e%';
explain extended select doc11.binary from t1 use document keys where doc11.binary like 'e%';
select doc11.binary from t1 use document keys where doc11.binary like 'e%';

explain extended select * from t1 where doc11.binary like 'e%';
select * from t1 where doc11.binary like 'e%';
explain extended select * from t1 use document keys where doc11.binary like 'e%';
select * from t1 use document keys where doc11.binary like 'e%';

explain extended select doc11 from t1 where doc11.binary like 'e%';
select doc11 from t1 where doc11.binary like 'e%';
explain extended select doc11 from t1 use document keys where doc11.binary like 'e%';
select doc11 from t1 use document keys where doc11.binary like 'e%';

explain extended select doc11.int from t1 where doc11.binary like 'e%';
select doc11.int from t1 where doc11.binary like 'e%';
explain extended select doc11.int from t1 use document keys where doc11.binary like 'e%';
select doc11.int from t1 use document keys where doc11.binary like 'e%';

#
# binary: covering index for range queries
#

# on not-nullable document column
explain extended select a1 from t1 where doc11.binary > 'eee';
select a1 from t1 where doc11.binary > 'eee';

explain extended select a1 from t1 use document keys where doc11.binary > 'eee';
select a1 from t1 use document keys where doc11.binary > 'eee';

explain extended select doc11.binary from t1 use document keys where doc11.binary >= 'kkk';
select doc11.binary from t1 use document keys where doc11.binary >= 'kkk';

# out of range
explain extended select a1 from t1 use document keys where doc11.binary > 'zzz';
select a1 from t1 use document keys where doc11.binary > 'zzz';

explain extended select a1, doc11.binary from t1 use document keys where doc11.binary < 'iii';
select a1, doc11.binary from t1 use document keys where doc11.binary < 'iii';

explain extended select doc11.binary, a1 from t1 use document keys where doc11.binary <= 'iii';
select doc11.binary, a1 from t1 use document keys where doc11.binary <= 'iii';

# out of range
explain extended select doc11.binary from t1 use document keys where doc11.binary < 'aaa';
select doc11.double from t1 use document keys where doc11.binary < 'aaa';

explain extended select a1, doc11.binary from t1 use document keys where doc11.binary > 'eee' and doc11.binary < 'iii';
select a1, doc11.binary from t1 use document keys where doc11.binary > 'eee' and doc11.binary < 'iii';

explain extended select a1 from t1 use document keys where doc11.binary >= 'eee' and doc11.binary <= 'iii';
select a1 from t1 use document keys where doc11.binary >= 'eee' and doc11.binary <= 'iii';

explain extended select a1 from t1 use document keys where doc11.binary > '' and doc11.binary < 'zzz';
select a1 from t1 use document keys where doc11.binary > '' and doc11.binary < 'zzz';

# between
explain extended select a1, doc11.binary from t1 use document keys where doc11.binary between 'eee' and 'iii';
select a1, doc11.binary from t1 use document keys where doc11.binary between 'eee' and 'iii';

explain extended select doc11.binary from t1 use document keys where doc11.binary between 'eee' and 'zzz';
select doc11.binary from t1 use document keys where doc11.binary between 'eee' and 'zzz';

# not between
explain extended select a1, doc11.binary from t1 use document keys where doc11.binary not between 'eee' and 'iii';
select a1, doc11.binary from t1 use document keys where doc11.binary not between 'eee' and 'iii';

explain extended select a1, doc11.binary from t1 use document keys where doc11.binary not between 'eee' and 'zzz';
select a1, doc11.binary from t1 use document keys where doc11.binary not between 'eee' and 'zzz';

# in
explain extended select a1, doc11.binary from t1 use document keys where doc11.binary in ('eee', 'ggg', 'iii', 'lll');
select a1, doc11.binary from t1 use document keys where doc11.binary in ('eee', 'ggg', 'iii', 'lll');

explain extended select a1, doc11.binary from t1 use document keys where doc11.binary in ('eee', 'zzz', '');
select a1, doc11.binary from t1 use document keys where doc11.binary in ('eee', 'zzz', '');

# not in
explain extended select a1, doc11.binary from t1 use document keys where doc11.binary not in ('eee', 'ggg', 'iii', 'lll');
select a1, doc11.binary from t1 use document keys where doc11.binary not in ('eee', 'ggg', 'iii', 'lll');

explain extended select a1, doc11.binary from t1 use document keys where doc11.binary not in ('', 'zzz', 'eee', 'fff', 'ggg', 'lll', 'iii', 'hhh');
select a1, doc11.binary from t1 use document keys where doc11.binary not in ('', 'zzz', 'eee', 'fff', 'ggg', 'lll', 'iii', 'hhh');

# multiple ranges without overlap
explain extended select doc11.binary from t1 use document keys
where doc11.binary > 'ccc' and doc11.binary < 'fff' or doc11.binary > 'ggg' and doc11.binary < 'hhh' or
      doc11.binary > 'iii' and doc11.binary < 'kkk' or doc11.binary >= 'lll' and doc11.binary <= 'zzz';

select doc11.binary from t1 use document keys
where doc11.binary > 'ccc' and doc11.binary < 'fff' or doc11.binary > 'ggg' and doc11.binary < 'hhh' or
      doc11.binary > 'iii' and doc11.binary < 'kkk' or doc11.binary >= 'lll' and doc11.binary <= 'zzz';

# multiple ranges with overlap
explain extended select doc11.binary from t1 use document keys
where doc11.binary > 'ccc' and doc11.binary < 'hhh' or doc11.binary > 'fff' and doc11.binary < 'iii' or
      doc11.binary > 'ggg' and doc11.binary <= 'zzz' or doc11.binary >= 'lll' and doc11.binary < 'zzz';

select doc11.binary from t1 use document keys
where doc11.binary > 'ccc' and doc11.binary < 'hhh' or doc11.binary > 'fff' and doc11.binary < 'iii' or
      doc11.binary > 'ggg' and doc11.binary <= 'zzz' or doc11.binary >= 'lll' and doc11.binary < 'zzz';

explain extended select doc11.binary from t1 use document keys
where ((doc11.binary > 'ccc' and doc11.binary < 'hhh') and (doc11.binary not between 'ggg' and 'iii')) or
       ((doc11.binary between 'kkk' and 'zzz') and (doc11.binary not in ('ddd', 'eee')));

select doc11.binary from t1 use document keys
where ((doc11.binary > 'ccc' and doc11.binary < 'hhh') and (doc11.binary not between 'ggg' and 'iii')) or
       ((doc11.binary between 'kkk' and 'zzz') and (doc11.binary not in ('ddd', 'eee')));

#
# binary: non-covering index for range queries
#

# on not-nullable document column
explain extended select a1, doc11.int from t1 where doc11.binary > 'eee';
select a1, doc11.int from t1 where doc11.binary > 'eee';

explain extended select a1, doc11.int from t1 use document keys where doc11.binary > 'eee';
select a1, doc11.int from t1 use document keys where doc11.binary > 'eee';

explain extended select doc11.binary, doc11.int from t1 use document keys where doc11.binary >= 'kkk';
select doc11.binary, doc11.int from t1 use document keys where doc11.binary >= 'kkk';

# out of range
explain extended select a1, doc11.int from t1 use document keys where doc11.binary > 'zzz';
select a1, doc11.int from t1 use document keys where doc11.binary > 'zzz';

explain extended select a1, doc11.binary, doc11.int from t1 use document keys where doc11.binary < 'iii';
select a1, doc11.binary, doc11.int from t1 use document keys where doc11.binary < 'iii';

explain extended select doc11.binary, a1, doc11.int from t1 use document keys where doc11.binary <= 'iii';
select doc11.binary, a1, doc11.int from t1 use document keys where doc11.binary <= 'iii';

# out of range
explain extended select doc11.binary, doc11.int from t1 use document keys where doc11.binary < 'aaa';
select doc11.binary, doc11.int from t1 use document keys where doc11.binary < 'aaa';

explain extended select a1, doc11.binary, doc11.int from t1 use document keys where doc11.binary > 'eee' and doc11.binary < 'iii';
select a1, doc11.binary, doc11.int from t1 use document keys where doc11.binary > 'eee' and doc11.binary < 'iii';

explain extended select a1, doc11.int from t1 use document keys where doc11.binary >= 'eee' and doc11.binary <= 'iii';
select a1, doc11.int from t1 use document keys where doc11.binary >= 'eee' and doc11.binary <= 'iii';

explain extended select a1, doc11.int from t1 use document keys where doc11.binary > '' and doc11.binary < 'zzz';
select a1, doc11.int from t1 use document keys where doc11.binary > '' and doc11.binary < 'zzz';

# between
explain extended select a1, doc11.binary, doc11.int from t1 use document keys where doc11.binary between 'eee' and 'iii';
select a1, doc11.binary, doc11.int from t1 use document keys where doc11.binary between 'eee' and 'iii';

explain extended select doc11.binary, doc11.int from t1 use document keys where doc11.binary between 'eee' and 'zzz';
select doc11.binary, doc11.int from t1 use document keys where doc11.binary between 'eee' and 'zzz';

# not between
explain extended select a1, doc11.binary, doc11.int from t1 use document keys where doc11.binary not between 'eee' and 'iii';
select a1, doc11.binary, doc11.int from t1 use document keys where doc11.binary not between 'eee' and 'iii';

explain extended select a1, doc11.binary, doc11.int from t1 use document keys where doc11.binary not between 'eee' and 'zzz';
select a1, doc11.binary, doc11.int from t1 use document keys where doc11.binary not between 'eee' and 'zzz';

# in
explain extended select a1, doc11.binary, doc11.int from t1 use document keys where doc11.binary in ('eee', 'ggg', 'iii', 'lll');
select a1, doc11.binary, doc11.int from t1 use document keys where doc11.binary in ('eee', 'ggg', 'iii', 'lll');

explain extended select a1, doc11.binary, doc11.int from t1 use document keys where doc11.binary in ('eee', 'zzz', '');
select a1, doc11.binary, doc11.int from t1 use document keys where doc11.binary in ('eee', 'zzz', '');

# not in
explain extended select a1, doc11.binary, doc11.int from t1 use document keys where doc11.binary not in ('eee', 'ggg', 'iii', 'lll');
select a1, doc11.binary, doc11.int from t1 use document keys where doc11.binary not in ('eee', 'ggg', 'iii', 'lll');

explain extended select a1, doc11.binary, doc11.int from t1 use document keys where doc11.binary not in ('', 'zzz', 'eee', 'fff', 'ggg', 'lll', 'iii', 'hhh');
select a1, doc11.binary, doc11.int from t1 use document keys where doc11.binary not in ('', 'zzz', 'eee', 'fff', 'ggg', 'lll', 'iii', 'hhh');

# multiple ranges without overlap
explain extended select doc11.binary, doc11.int from t1 use document keys
where doc11.binary > 'ccc' and doc11.binary < 'fff' or doc11.binary > 'ggg' and doc11.binary < 'hhh' or
      doc11.binary > 'iii' and doc11.binary < 'kkk' or doc11.binary >= 'lll' and doc11.binary <= 'zzz';

select doc11.binary, doc11.int from t1 use document keys
where doc11.binary > 'ccc' and doc11.binary < 'fff' or doc11.binary > 'ggg' and doc11.binary < 'hhh' or
      doc11.binary > 'iii' and doc11.binary < 'kkk' or doc11.binary >= 'lll' and doc11.binary <= 'zzz';

# multiple ranges with overlap
explain extended select doc11.binary, doc11.int from t1 use document keys
where doc11.binary > 'ccc' and doc11.binary < 'hhh' or doc11.binary > 'fff' and doc11.binary < 'iii' or
      doc11.binary > 'ggg' and doc11.binary <= 'zzz' or doc11.binary >= 'lll' and doc11.binary < 'zzz';

select doc11.binary, doc11.int from t1 use document keys
where doc11.binary > 'ccc' and doc11.binary < 'hhh' or doc11.binary > 'fff' and doc11.binary < 'iii' or
      doc11.binary > 'ggg' and doc11.binary <= 'zzz' or doc11.binary >= 'lll' and doc11.binary < 'zzz';

explain extended select doc11.binary, doc11.int from t1 use document keys
where ((doc11.binary > 'ccc' and doc11.binary < 'hhh') and (doc11.binary not between 'ggg' and 'iii')) or
       ((doc11.binary between 'kkk' and 'zzz') and (doc11.binary not in ('ddd', 'eee')));

select doc11.binary, doc11.int from t1 use document keys
where ((doc11.binary > 'ccc' and doc11.binary < 'hhh') and (doc11.binary not between 'ggg' and 'iii')) or
       ((doc11.binary between 'kkk' and 'zzz') and (doc11.binary not in ('ddd', 'eee')));

##
## composite index
##

#
# index scan
#

# doc1_b and b_doc1
explain extended select doc11.int from t1 where b1 = 5;
select doc11.int from t1 where b1 = 5;
explain extended select doc11.int from t1 use document keys where b1 = 5;
select doc11.int from t1 use document keys where b1 = 5;

explain extended select b1 from t1 where doc11.int = 5;
select b1 from t1 where doc11.int = 5;
explain extended select b1 from t1 use document keys where doc11.int = 5;
select b1 from t1 use document keys where doc11.int = 5;
# group by
explain extended select count(b1) from t1 use document keys group by doc11.int having doc11.int = 5;
select count(b1) from t1 use document keys group by doc11.int having doc11.int = 5;

explain extended select b1 from t1 where doc11.int > 5;
select b1 from t1 where doc11.int > 5;
explain extended select d1 from t1 use document keys where doc11.int > 5;
select b1 from t1 use document keys where doc11.int > 5;

# group by
explain extended select sum(b1) from t1 use document keys group by doc11.int having doc11.int > 5;
select sum(b1) from t1 use document keys group by doc11.int having doc11.int > 5;

# doc1_c
explain extended select doc11.double from t1 where c1 = 5.5;
select doc11.double from t1 where c1 = 5.5;
explain extended select doc11.double from t1 use document keys where c1 = 5.5;
select doc11.double from t1 use document keys where c1 = 5.5;

explain extended select c1 from t1 where doc11.double = 5.5;
select c1 from t1 where doc11.double = 5.5;

explain extended select c1 from t1 use document keys where doc11.double = 5.5;
select c1 from t1 use document keys where doc11.double = 5.5;

# work-around
explain extended select c1 from t1 use document keys where doc11.double = '5.5';
select c1 from t1 use document keys where doc11.double = '5.5';

explain extended select c1 from t1 where doc11.double > 5.5;
select c1 from t1 where doc11.double > 5.5;
explain extended select c1 from t1 use document keys where doc11.double > 5.5;
select c1 from t1 use document keys where doc11.double > 5.5;

# doc1_d
explain extended select doc11.int from t1 where d1 = 'eee';
select doc11.int from t1 where d1 = 'eee';
explain extended select doc11.int from t1 use document keys where d1 = 'eee';
select doc11.int from t1 use document keys where d1 = 'eee';

explain extended select d1 from t1 where doc11.int = 5;
select d1 from t1 where doc11.int = 5;
explain extended select d1 from t1 use document keys where doc11.int = 5;
select d1 from t1 use document keys where doc11.int = 5;

explain extended select d1 from t1 where doc11.int > 5;
select d1 from t1 where doc11.int > 5;
explain extended select d1 from t1 use document keys where doc11.int > 5;
select d1 from t1 use document keys where doc11.int > 5;

explain extended select d1 from t1 where doc11.int = '5';
select d1 from t1 where doc11.int = '5';
explain extended select d1 from t1 use document keys where doc11.int = '5';
select d1 from t1 use document keys where doc11.int = '5';

explain extended select d1 from t1 where doc11.int < '5';
select d1 from t1 where doc11.int < '5';
explain extended select d1 from t1 use document keys where doc11.int < '5';
select d1 from t1 use document keys where doc11.int < '5';

explain extended select a1 from t1 where doc11.int = 5;
select a1 from t1 where doc11.int = 5;
explain extended select a1 from t1 use document keys where doc11.int = 5;
select a1 from t1 use document keys where doc11.int = 5;

explain extended select a1 from t1 where doc11.int >= 5;
select a1 from t1 where doc11.int >= 5;
explain extended select a1 from t1 use document keys where doc11.int >= 5;
select a1 from t1 use document keys where doc11.int >= 5;

explain extended select a1 from t1 where d1 like 'eee' and doc11.int = 5;
select a1 from t1 where d1 like 'eee' and doc11.int = 5;
explain extended select a1 from t1 use document keys where d1 like 'eee' and doc11.int = 5;
select a1 from t1 use document keys where d1 like 'eee' and doc11.int = 5;

explain extended select a1 from t1 where d1 like 'e%' and doc11.int > 4;
select a1 from t1 where d1 like 'e%' and doc11.int > 4;
explain extended select a1 from t1 use document keys where d1 like 'e%' and doc11.int > 4;
select a1 from t1 use document keys where d1 like 'e%' and doc11.int > 4;

explain extended select a1, d1, doc11.int from t1 where d1 like 'eee' and doc11.int = 5;
select a1, d1, doc11.int from t1 where d1 like 'eee' and doc11.int = 5;
explain extended select a1, d1, doc11.int from t1 use document keys where d1 like 'eee' and doc11.int = 5;
select a1, d1, doc11.int from t1 use document keys where d1 like 'eee' and doc11.int = 5;

explain extended select a1, d1, doc11.int from t1 where d1 like 'e%' and doc11.int < 6;
select a1, d1, doc11.int from t1 where d1 like 'e%' and doc11.int < 6;
explain extended select a1, d1, doc11.int from t1 use document keys where d1 like 'e%' and doc11.int < 6;
select a1, d1, doc11.int from t1 use document keys where d1 like 'e%' and doc11.int < 6;

#
# index access but no covering index
#
explain extended select b1 from t1 where doc11.int = 5;
select b1 from t1 where doc11.int = 5;
explain extended select b1 from t1 use document keys where doc11.int = 5;
select b1 from t1 use document keys where doc11.int = 5;

explain extended select * from t1 where doc11.int = 5;
select * from t1 where doc11.int = 5;
explain extended select * from t1 use document keys where doc11.int = 5;
select * from t1 use document keys where doc11.int = 5;

explain extended select doc11.double from t1 where doc11.int = 5;
select doc11.double from t1 where doc11.int = 5;

explain extended select doc11.double from t1 use document keys where doc11.int = 5;
select doc11.double from t1 use document keys where doc11.int = 5;

explain extended select doc11 from t1 where doc11.int = 5;
select doc11 from t1 where doc11.int = 5;

explain extended select doc11 from t1 use document keys where doc11.int = 5;
select doc11 from t1 use document keys where doc11.int = 5;

# if the select list is not covered by index, query works fine as well
explain extended select b1, doc11.double from t1 where doc11.int = 5;
select b1, doc11.double from t1 where doc11.int = 5;
explain extended select b1, doc11.double from t1 use document keys where doc11.int = 5;
select b1, doc11.double from t1 use document keys where doc11.int = 5;

explain extended select b1, doc11 from t1 where doc11.int = 5;
select b1, doc11 from t1 where doc11.int = 5;
explain extended select b1, doc11 from t1 use document keys where doc11.int = 5;
select b1, doc11 from t1 use document keys where doc11.int = 5;

#
# not all conditions are covered by index
#
explain extended select b1 from t1 where doc11.int = 5 and d1 = 5.5;
select b1 from t1 where doc11.int = 5 and d1 = 5.5;
explain extended select b1 from t1 use document keys where doc11.int = 5 and d1 = 5.5;
select b1 from t1 use document keys where doc11.int = 5 and d1 = 5.5;

explain extended select b1 from t1 where doc11.int = 5 and d1 > 5;
select b1 from t1 where doc11.int = 5 and d1 > 5;
explain extended select b1 from t1 use document keys where doc11.int = 5 and d1 > 5;
select b1 from t1 use document keys where doc11.int = 5 and d1 > 5;

#
# doc1 key is considered but the smaller b_a key is picked
#
explain extended select c1 from t1 where doc11.int = 5 and b1 = 5;
select c1 from t1 where doc11.int = 5 and b1 = 5;
explain extended select c1 from t1 use document keys where doc11.int = 5 and b1 = 5;
select c1 from t1 use document keys where doc11.int = 5 and b1 = 5;

#
# full table scan: where-condition is not part of any indexes
#
explain extended select doc11.int from t1 where doc11.id = 5;
select doc11.int from t1 where doc11.id = 5;
explain extended select doc11.int from t1 use document keys where doc11.id = 5;
select doc11.int from t1 use document keys where doc11.id = 5;

explain extended select a1, b1 from t1 where doc11.id = 5;
select a1, b1 from t1 where doc11.id = 5;
explain extended select a1, b1 from t1 use document keys where doc11.id = 5;
select a1, b1 from t1 use document keys where doc11.id = 5;

# to check whether value of document path in the temporal table can be read correct when using index
select a1, doc11.int from t1 use document keys order by doc11.int;


################################################################################
###
### Multi-table equi-joins and range joins
###

##
## convering index for two table equi-join
##

# int
explain extended select t1.doc11.int, t2.doc21.int
from t1 use document keys, t2 use document keys
where t1.doc11.int = t2.doc21.int;

select t1.doc11.int, t2.doc21.int
from t1 use document keys, t2 use document keys
where t1.doc11.int = t2.doc21.int;

# bool
explain extended select t1.doc11.bool, t2.doc21.bool
from t1 use document keys, t2 use document keys
where t1.doc11.bool = t2.doc21.bool and t1.doc11.int < 3;

# double
explain extended select t1.doc11.double, t2.doc21.double
from t1 use document keys, t2 use document keys
where t1.doc11.double = t2.doc21.double;

--echo NOT-A-BUG: Caused by the inaccuracy of double in MySQL
select t1.doc11.double, t2.doc21.double
from t1 use document keys, t2 use document keys
where t1.doc11.double = t2.doc21.double;

# string
explain extended select t1.doc11.string, t2.doc21.string
from t1 use document keys, t2 use document keys
where t1.doc11.string = t2.doc21.string;

select t1.doc11.string, t2.doc21.string
from t1 use document keys, t2 use document keys
where t1.doc11.string = t2.doc21.string;

##
## non-convering index for two table equi-join
##

# int
explain extended select t1.doc11.int, t1.doc11.string, t2.doc21.int, t2.doc21.string
from t1 use document keys, t2 use document keys
where t1.doc11.int = t2.doc21.int;

select t1.doc11.int, t1.doc11.string, t2.doc21.int, t2.doc21.string
from t1 use document keys, t2 use document keys
where t1.doc11.int = t2.doc21.int;

# bool
explain extended select t1.doc11.bool, t1.doc11.string, t2.doc21.bool, t2.doc21.string
from t1 use document keys, t2 use document keys
where t1.doc11.bool = t2.doc21.bool and t1.doc11.bool is false;

# double
explain extended select t1.doc11.double, t1.doc11.string, t2.doc21.double, t2.doc21.string
from t1 use document keys, t2 use document keys
where t1.doc11.double = t2.doc21.double;

--echo NOT-A-BUG: Caused by the inaccuracy of double in MySQL
select t1.doc11.double, t1.doc11.string, t2.doc21.double, t2.doc21.string
from t1 use document keys, t2 use document keys
where t1.doc11.double = t2.doc21.double;

# string
explain extended select t1.doc11.string, t1.doc11.int, t2.doc21.string, t2.doc21.int
from t1 use document keys, t2 use document keys
where t1.doc11.string = t2.doc21.string;

select t1.doc11.string, t1.doc11.int, t2.doc21.string, t2.doc21.int
from t1 use document keys, t2 use document keys
where t1.doc11.string = t2.doc21.string;

##
## covering index for two table range join
##

# int
explain extended select t1.doc11.int, t2.doc21.int
from t1 use document keys, t2 use document keys
where t1.doc11.int > t2.doc21.int and t2.doc21.int > 10;

select t1.doc11.int, t2.doc21.int
from t1 use document keys, t2 use document keys
where t1.doc11.int > t2.doc21.int and t2.doc21.int > 10;

explain extended select t1.doc11.int, t2.doc21.int
from t1 use document keys, t2 use document keys
where (t1.doc11.int between 3 and 8) and (t2.doc21.int between 7 and 9) and t1.doc11.int > t2.doc21.int;

select t1.doc11.int, t2.doc21.int
from t1 use document keys, t2 use document keys
where (t1.doc11.int between 3 and 8) and (t2.doc21.int between 7 and 9) and t1.doc11.int > t2.doc21.int;

# bool
explain extended select t1.doc11.bool, t2.doc21.bool
from t1 use document keys, t2 use document keys
where t1.doc11.bool > t2.doc21.bool and t2.doc21.bool > 0;

select t1.doc11.bool, t2.doc21.bool
from t1 use document keys, t2 use document keys
where t1.doc11.bool > t2.doc21.bool and t2.doc21.bool > 0;

explain extended select t1.doc11.bool, t2.doc21.bool
from t1 use document keys, t2 use document keys
where (t1.doc11.bool between 1 and 2) and (t2.doc21.bool between 7 and 9) and t1.doc11.bool > t2.doc21.bool;

select t1.doc11.bool, t2.doc21.bool
from t1 use document keys, t2 use document keys
where (t1.doc11.bool between 1 and 2) and (t2.doc21.bool between 7 and 9) and t1.doc11.bool > t2.doc21.bool;

# double
explain extended select t1.doc11.double, t2.doc21.double
from t1 use document keys, t2 use document keys
where t1.doc11.double > t2.doc21.double;

--echo NOT-A-BUG: Caused by the inaccuracy of double in MySQL
select t1.doc11.double, t2.doc21.double
from t1 use document keys, t2 use document keys
where t1.doc11.double > t2.doc21.double;

explain extended select t1.doc11.double, t2.doc21.double
from t1 use document keys, t2 use document keys
where t1.doc11.double > t2.doc21.double and t2.doc21.double > 10.1;

select t1.doc11.double, t2.doc21.double
from t1 use document keys, t2 use document keys
where t1.doc11.double > t2.doc21.double and t2.doc21.double > 10.1;

explain extended select t1.doc11.double, t2.doc21.double
from t1 use document keys, t2 use document keys
where (t1.doc11.double between 3.3 and 8.8) and (t2.doc21.double between 7.7 and 9.9) and t1.doc11.double > t2.doc21.double;

select t1.doc11.double, t2.doc21.double
from t1 use document keys, t2 use document keys
where (t1.doc11.double between 3.3 and 8.8) and (t2.doc21.double between 7.7 and 9.9) and t1.doc11.double > t2.doc21.double;

# string
explain extended select t1.doc11.string, t2.doc21.string
from t1 use document keys, t2 use document keys
where t1.doc11.string > t2.doc21.string and t2.doc21.string > 'ggg';

select t1.doc11.string, t2.doc21.string
from t1 use document keys, t2 use document keys
where t1.doc11.string > t2.doc21.string and t2.doc21.string > 'ggg';

explain extended select t1.doc11.string, t2.doc21.string
from t1 use document keys, t2 use document keys
where (t1.doc11.string between 'ccc' and 'hhh') and (t2.doc21.string between 'ggg' and 'iii') and t1.doc11.string > t2.doc21.string;

--echo FIXME!!
select t1.doc11.string, t2.doc21.string
from t1 use document keys, t2 use document keys
where (t1.doc11.string between 'ccc' and 'hhh') and (t2.doc21.string between 'ggg' and 'iii') and t1.doc11.string > t2.doc21.string;

# binary
explain extended select t1.doc11.binary, t2.doc21.binary
from t1 use document keys, t2 use document keys
where t1.doc11.binary > t2.doc21.binary and t2.doc21.binary > 'ggg';

select t1.doc11.binary, t2.doc21.binary
from t1 use document keys, t2 use document keys
where t1.doc11.binary > t2.doc21.binary and t2.doc21.binary > 'ggg';

explain extended select t1.doc11.binary, t2.doc21.binary
from t1 use document keys, t2 use document keys
where (t1.doc11.binary between 'ccc' and 'hhh') and (t2.doc21.binary between 'ggg' and 'iii') and t1.doc11.binary > t2.doc21.binary;

--echo FIXME!!
select t1.doc11.binary, t2.doc21.binary
from t1 use document keys, t2 use document keys
where (t1.doc11.binary between 'ccc' and 'hhh') and (t2.doc21.binary between 'ggg' and 'iii') and t1.doc11.binary > t2.doc21.string;

##
## non-covering index for two table range join
##

# int
explain extended select t1.doc11.int, t1.doc11.string, t2.doc21.int, t2.doc21.string
from t1 use document keys, t2 use document keys
where t1.doc11.int > t2.doc21.int and t2.doc21.int > 10;

select t1.doc11.int, t1.doc11.string, t2.doc21.int, t2.doc21.string
from t1 use document keys, t2 use document keys
where t1.doc11.int > t2.doc21.int and t2.doc21.int > 10;

explain extended select t1.doc11.int, t1.doc11.string, t2.doc21.int, t2.doc21.string
from t1 use document keys, t2 use document keys
where (t1.doc11.int between 3 and 8) and (t2.doc21.int between 7 and 9) and t1.doc11.int > t2.doc21.int;

select t1.doc11.int, t1.doc11.string, t2.doc21.int, t2.doc21.string
from t1 use document keys, t2 use document keys
where (t1.doc11.int between 3 and 8) and (t2.doc21.int between 7 and 9) and t1.doc11.int > t2.doc21.int;

# bool
explain extended select t1.doc11.bool, t1.doc11.string, t2.doc21.bool, t2.doc21.string
from t1 use document keys, t2 use document keys
where t1.doc11.bool > t2.doc21.bool and t2.doc21.bool > 0;

explain extended select t1.doc11.bool, t1.doc11.string, t2.doc21.bool, t2.doc21.string
from t1 use document keys, t2 use document keys
where (t1.doc11.bool between 0 and 1) and (t2.doc21.bool between 1 and 2) and t1.doc11.bool >= t2.doc21.bool;

# double
explain extended select t1.doc11.double, t1.doc11.string, t2.doc21.double, t2.doc21.string
from t1 use document keys, t2 use document keys
where t1.doc11.double > t2.doc21.double;

--echo NOT-A-BUG: Caused by the inaccuracy of double in MySQL
select t1.doc11.double, t1.doc11.string, t2.doc21.double, t2.doc21.string
from t1 use document keys, t2 use document keys
where t1.doc11.double > t2.doc21.double;

explain extended select t1.doc11.double, t1.doc11.string, t2.doc21.double, t2.doc21.string
from t1 use document keys, t2 use document keys
where t1.doc11.double > t2.doc21.double and t2.doc21.double > 10.1;

select t1.doc11.double, t1.doc11.string, t2.doc21.double, t2.doc21.string
from t1 use document keys, t2 use document keys
where t1.doc11.double > t2.doc21.double and t2.doc21.double > 10.1;

explain extended select t1.doc11.double, t1.doc11.string, t2.doc21.double, t2.doc21.string
from t1 use document keys, t2 use document keys
where (t1.doc11.double between 3.3 and 8.8) and (t2.doc21.double between 7.7 and 9.9) and t1.doc11.double > t2.doc21.double;

select t1.doc11.double, t1.doc11.string, t2.doc21.double, t2.doc21.string
from t1 use document keys, t2 use document keys
where (t1.doc11.double between 3.3 and 8.8) and (t2.doc21.double between 7.7 and 9.9) and t1.doc11.double > t2.doc21.double;

# string
explain extended select t1.doc11.string, t1.doc11.int, t2.doc21.string, t2.doc21.int
from t1 use document keys, t2 use document keys
where t1.doc11.string > t2.doc21.string and t2.doc21.string > 'ggg';

select t1.doc11.string, t1.doc11.int, t2.doc21.string, t2.doc21.int
from t1 use document keys, t2 use document keys
where t1.doc11.string > t2.doc21.string and t2.doc21.string > 'ggg';

explain extended select t1.doc11.string, t1.doc11.int, t2.doc21.string, t2.doc21.int
from t1 use document keys, t2 use document keys
where (t1.doc11.string between 'ccc' and 'jjj') and (t2.doc21.string between 'iii' and 'kkk') and (t1.doc11.string > t2.doc21.string);

--echo FIXME!!!
select t1.doc11.string, t1.doc11.int, t2.doc21.string, t2.doc21.int
from t1 use document keys, t2 use document keys
where (t1.doc11.string between 'ccc' and 'jjj') and (t2.doc21.string between 'iii' and 'kkk') and (t1.doc11.string > t2.doc21.string);

# binary
explain extended select t1.doc11.binary, t1.doc11.int, t2.doc21.binary, t2.doc21.int
from t1 use document keys, t2 use document keys
where t1.doc11.binary > t2.doc21.binary and t2.doc21.binary > 'ggg';

select t1.doc11.binary, t1.doc11.int, t2.doc21.binary, t2.doc21.int
from t1 use document keys, t2 use document keys
where t1.doc11.binary > t2.doc21.binary and t2.doc21.binary > 'ggg';

explain extended select t1.doc11.binary, t1.doc11.int, t2.doc21.binary, t2.doc21.int
from t1 use document keys, t2 use document keys
where (t1.doc11.binary between 'ccc' and 'jjj') and (t2.doc21.binary between 'iii' and 'kkk') and (t1.doc11.binary > t2.doc21.binary);

select t1.doc11.binary, t1.doc11.int, t2.doc21.binary, t2.doc21.int
from t1 use document keys, t2 use document keys
where (t1.doc11.binary between 'ccc' and 'jjj') and (t2.doc21.binary between 'iii' and 'kkk') and (t1.doc11.binary > t2.doc21.binary);

##
## covering index for three table equi-join
##

explain extended select t1.doc11.int, t2.doc21.int, t3.doc31.int
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.int = t2.doc21.int and t1.doc11.int = t3.doc31.int;

select t1.doc11.int, t2.doc21.int, t3.doc31.int
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.int = t2.doc21.int and t1.doc11.int = t3.doc31.int;

##
## non-covering index for three table equi-join
##

# int
explain extended select t1.doc11.int, t1.doc11.string, t2.doc21.int, t2.doc21.string, t3.doc31.int, t3.doc31.string
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.int = t2.doc21.int and t1.doc11.int = t3.doc31.int;

select t1.doc11.int, t1.doc11.string, t2.doc21.int, t2.doc21.string, t3.doc31.int, t3.doc31.string
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.int = t2.doc21.int and t1.doc11.int = t3.doc31.int;

# bool
explain extended select t1.doc11.bool, t1.doc11.string, t2.doc21.bool, t2.doc21.string, t3.doc31.bool, t3.doc31.string
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.bool = t2.doc21.bool and t1.doc11.bool = t3.doc31.bool;

# double
explain extended select t1.doc11.double, t1.doc11.string, t2.doc21.double, t2.doc21.string, t3.doc31.double, t3.doc31.string
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.double = t2.doc21.double and t1.doc11.double = t3.doc31.double;

select t1.doc11.double, t1.doc11.string, t2.doc21.double, t2.doc21.string, t3.doc31.double, t3.doc31.string
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.double = t2.doc21.double and t1.doc11.double = t3.doc31.double;

# string
explain extended select t1.doc11.int, t1.doc11.string, t2.doc21.int, t2.doc21.string, t3.doc31.int, t3.doc31.string
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.string = t2.doc21.string and t1.doc11.string = t3.doc31.string;

select t1.doc11.int, t1.doc11.string, t2.doc21.int, t2.doc21.string, t3.doc31.int, t3.doc31.string
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.string = t2.doc21.string and t1.doc11.string = t3.doc31.string;

# binary
explain extended select t1.doc11.int, t1.doc11.binary, t2.doc21.int, t2.doc21.binary, t3.doc31.int, t3.doc31.binary
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.binary = t2.doc21.binary and t1.doc11.binary = t3.doc31.binary;

--echo FIXME!!
select t1.doc11.int, t1.doc11.binary, t2.doc21.int, t2.doc21.binary, t3.doc31.int, t3.doc31.binary
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.binary = t2.doc21.binary and t1.doc11.binary = t3.doc31.binary;

##
## covering index for three table range join
##

# int
explain extended select t1.doc11.int, t2.doc21.int, t3.doc31.int
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.int > t2.doc21.int and t2.doc21.int > t3.doc31.int and t3.doc31.int > 10;

select t1.doc11.int, t2.doc21.int, t3.doc31.int
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.int > t2.doc21.int and t2.doc21.int > t3.doc31.int and t3.doc31.int > 10;

explain extended select t1.doc11.int, t2.doc21.int, t3.doc31.int
from t1 use document keys, t2 use document keys, t3 use document keys
where (t1.doc11.int between 3 and 8) and (t2.doc21.int between 7 and 9) and (t3.doc31.int between 6 and 10)
      and (t1.doc11.int > t2.doc21.int and t2.doc21.int > t3.doc31.int);

select t1.doc11.int, t2.doc21.int, t3.doc31.int
from t1 use document keys, t2 use document keys, t3 use document keys
where (t1.doc11.int between 3 and 8) and (t2.doc21.int between 7 and 9) and (t3.doc31.int between 6 and 10)
      and (t1.doc11.int > t2.doc21.int and t2.doc21.int > t3.doc31.int);

# bool
explain extended select t1.doc11.bool, t2.doc21.bool, t3.doc31.bool
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.bool > t2.doc21.bool and t2.doc21.bool > t3.doc31.bool and t3.doc31.bool > 0;

explain extended select t1.doc11.bool, t2.doc21.bool, t3.doc31.bool
from t1 use document keys, t2 use document keys, t3 use document keys
where (t1.doc11.bool between 1 and 2) and (t2.doc21.bool between 1 and 2) and (t3.doc31.bool between 0 and 1)
      and (t1.doc11.bool > t2.doc21.bool and t2.doc21.bool > t3.doc31.bool);

# double
explain extended select t1.doc11.double, t2.doc21.double, t3.doc31.double
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.double > t2.doc21.double and t2.doc21.double > t3.doc31.double and t3.doc31.double > 10.1;

--echo NOT-A-BUG: Caused by the inaccuracy of double in MySQL
select t1.doc11.double, t2.doc21.double, t3.doc31.double
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.double > t2.doc21.double and t2.doc21.double > t3.doc31.double and t3.doc31.double > 10.5;

explain extended select t1.doc11.double, t2.doc21.double, t3.doc31.double
from t1 use document keys, t2 use document keys, t3 use document keys
where (t1.doc11.double between 3.3 and 8.8) and (t2.doc21.double between 7.7 and 9.9) and (t3.doc31.double between 6.6 and 10.1)
      and (t1.doc11.double > t2.doc21.double and t2.doc21.double > t3.doc31.double);

select t1.doc11.double, t2.doc21.double, t3.doc31.double
from t1 use document keys, t2 use document keys, t3 use document keys
where (t1.doc11.double between 3.3 and 8.8) and (t2.doc21.double between 7.7 and 9.9) and (t3.doc31.double between 6.6 and 10.1)
      and (t1.doc11.double > t2.doc21.double and t2.doc21.double > t3.doc31.double);

# string
explain extended select t1.doc11.string, t2.doc21.string, t3.doc31.string
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.string > t2.doc21.string and t2.doc21.string > t3.doc31.string and t3.doc31.string > 'ggg';

--echo FIXME!!
select t1.doc11.string, t2.doc21.string, t3.doc31.string
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.string > t2.doc21.string and t2.doc21.string > t3.doc31.string and t3.doc31.string > 'ggg';

explain extended select t1.doc11.string, t2.doc21.string, t3.doc31.string
from t1 use document keys, t2 use document keys, t3 use document keys
where (t1.doc11.string between 'ccc' and 'hhh') and (t2.doc21.string between 'ggg' and 'iii') and (t3.doc31.string between 'fff' and 'jjj')
      and (t1.doc11.string > t2.doc21.string and t2.doc21.string > t3.doc31.string);

select t1.doc11.string, t2.doc21.string, t3.doc31.string
from t1 use document keys, t2 use document keys, t3 use document keys
where (t1.doc11.string between 'ccc' and 'hhh') and (t2.doc21.string between 'ggg' and 'iii') and (t3.doc31.string between 'fff' and 'jjj')
      and (t1.doc11.string > t2.doc21.string and t2.doc21.string > t3.doc31.string);

# binary
explain extended select t1.doc11.binary, t2.doc21.binary, t3.doc31.binary
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.binary > t2.doc21.binary and t2.doc21.binary > t3.doc31.binary and t3.doc31.binary > 'ggg';

--echo FIXME!!
select t1.doc11.binary, t2.doc21.binary, t3.doc31.binary
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.binary > t2.doc21.binary and t2.doc21.binary > t3.doc31.binary and t3.doc31.binary > 'ggg';

explain extended select t1.doc11.binary, t2.doc21.binary, t3.doc31.binary
from t1 use document keys, t2 use document keys, t3 use document keys
where (t1.doc11.binary between 'ccc' and 'hhh') and (t2.doc21.binary between 'ggg' and 'iii') and (t3.doc31.binary between 'fff' and 'jjj')
      and (t1.doc11.binary > t2.doc21.binary and t2.doc21.binary > t3.doc31.binary);

select t1.doc11.binary, t2.doc21.binary, t3.doc31.binary
from t1 use document keys, t2 use document keys, t3 use document keys
where (t1.doc11.binary between 'ccc' and 'hhh') and (t2.doc21.binary between 'ggg' and 'iii') and (t3.doc31.binary between 'fff' and 'jjj')
      and (t1.doc11.binary > t2.doc21.binary and t2.doc21.binary > t3.doc31.binary);

##
## non-covering index for three table range join
##

# int
explain extended select t1.doc11.int, t1.doc11.string, t2.doc21.int, t2.doc21.string, t3.doc31.int, t3.doc31.string
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.int > t2.doc21.int and t2.doc21.int > t3.doc31.int and t3.doc31.int > 10;

select t1.doc11.int, t1.doc11.string, t2.doc21.int, t2.doc21.string, t3.doc31.int, t3.doc31.string
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.int > t2.doc21.int and t2.doc21.int > t3.doc31.int and t3.doc31.int > 10;

explain extended select t1.doc11.int, t1.doc11.string, t2.doc21.int, t2.doc21.string, t3.doc31.int, t3.doc31.string
from t1 use document keys, t2 use document keys, t3 use document keys
where (t1.doc11.int between 3 and 8) and (t2.doc21.int between 7 and 9) and (t3.doc31.int between 6 and 10)
      and (t1.doc11.int > t2.doc21.int and t2.doc21.int > t3.doc31.int);

select t1.doc11.int, t1.doc11.string, t2.doc21.int, t2.doc21.string, t3.doc31.int, t3.doc31.string
from t1 use document keys, t2 use document keys, t3 use document keys
where (t1.doc11.int between 3 and 8) and (t2.doc21.int between 7 and 9) and (t3.doc31.int between 6 and 10)
      and (t1.doc11.int > t2.doc21.int and t2.doc21.int > t3.doc31.int);

# bool
explain extended select t1.doc11.int, t1.doc11.bool, t2.doc21.int, t2.doc21.bool, t3.doc31.int, t3.doc31.bool
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.bool > t2.doc21.bool and t2.doc21.bool > t3.doc31.bool and t3.doc31.bool > 0;

explain extended select t1.doc11.int, t1.doc11.bool, t2.doc21.int, t2.doc21.bool, t3.doc31.int, t3.doc31.bool
from t1 use document keys, t2 use document keys, t3 use document keys
where (t1.doc11.bool between 1 and 2) and (t2.doc21.bool between 1 and 2) and (t3.doc31.bool between 0 and 1)
      and (t1.doc11.bool > t2.doc21.bool and t2.doc21.bool > t3.doc31.bool);

# double
explain extended select t1.doc11.int, t1.doc11.double, t2.doc21.int, t2.doc21.double, t3.doc31.int, t3.doc31.double
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.double > t2.doc21.double and t2.doc21.double > t3.doc31.double and t3.doc31.double > 10.1;

--echo NOT-A-BUG: Caused by the inaccuracy of double in MySQL
select t1.doc11.int, t1.doc11.double, t2.doc21.int, t2.doc21.double, t3.doc31.int, t3.doc31.double
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.double > t2.doc21.double and t2.doc21.double > t3.doc31.double and t3.doc31.double > 10.5;

explain extended select t1.doc11.int, t1.doc11.double, t2.doc21.int, t2.doc21.double, t3.doc31.int, t3.doc31.double
from t1 use document keys, t2 use document keys, t3 use document keys
where (t1.doc11.double between 3.3 and 8.8) and (t2.doc21.double between 7.7 and 9.9) and (t3.doc31.double between 6.6 and 10.1)
      and (t1.doc11.double > t2.doc21.double and t2.doc21.double > t3.doc31.double);

select t1.doc11.int, t1.doc11.double, t2.doc21.int, t2.doc21.double, t3.doc31.int, t3.doc31.double
from t1 use document keys, t2 use document keys, t3 use document keys
where (t1.doc11.double between 3.3 and 8.8) and (t2.doc21.double between 7.7 and 9.9) and (t3.doc31.double between 6.6 and 10.1)
      and (t1.doc11.double > t2.doc21.double and t2.doc21.double > t3.doc31.double);

# string
explain extended select t1.doc11.int, t1.doc11.string, t2.doc21.int, t2.doc21.string, t3.doc31.int, t3.doc31.string
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.string > t2.doc21.string and t2.doc21.string > t3.doc31.string and t3.doc31.string > 'ggg';

--echo FIXME!!
select t1.doc11.int, t1.doc11.string, t2.doc21.int, t2.doc21.string, t3.doc31.int, t3.doc31.string
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.string > t2.doc21.string and t2.doc21.string > t3.doc31.string and t3.doc31.string > 'ggg';

explain extended select t1.doc11.int, t1.doc11.string, t2.doc21.int, t2.doc21.string, t3.doc31.int, t3.doc31.string
from t1 use document keys, t2 use document keys, t3 use document keys
where (t1.doc11.string between 'ccc' and 'jjj') and (t2.doc21.string between 'ggg' and 'iii') and (t3.doc31.string between 'fff' and 'ggg')
      and (t1.doc11.string > t2.doc21.string and t2.doc21.string > t3.doc31.string);

--echo FIXME!!
select t1.doc11.int, t1.doc11.string, t2.doc21.int, t2.doc21.string, t3.doc31.int, t3.doc31.string
from t1 use document keys, t2 use document keys, t3 use document keys
where (t1.doc11.string between 'ccc' and 'jjj') and (t2.doc21.string between 'ggg' and 'iii') and (t3.doc31.string between 'fff' and 'ggg')
      and (t1.doc11.string > t2.doc21.string and t2.doc21.string > t3.doc31.string);

# binary
explain extended select t1.doc11.int, t1.doc11.binary, t2.doc21.int, t2.doc21.binary, t3.doc31.int, t3.doc31.binary
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.binary > t2.doc21.binary and t2.doc21.binary > t3.doc31.binary and t3.doc31.binary > 'ggg';

--echo FIXME!!
select t1.doc11.int, t1.doc11.binary, t2.doc21.int, t2.doc21.binary, t3.doc31.int, t3.doc31.binary
from t1 use document keys, t2 use document keys, t3 use document keys
where t1.doc11.binary > t2.doc21.binary and t2.doc21.binary > t3.doc31.binary and t3.doc31.binary > 'ggg';

explain extended select t1.doc11.int, t1.doc11.binary, t2.doc21.int, t2.doc21.binary, t3.doc31.int, t3.doc31.binary
from t1 use document keys, t2 use document keys, t3 use document keys
where (t1.doc11.binary between 'ccc' and 'hhh') and (t2.doc21.binary between 'ggg' and 'iii') and (t3.doc31.binary between 'fff' and 'jjj')
      and (t1.doc11.binary > t2.doc21.binary and t2.doc21.binary > t3.doc31.binary);

select t1.doc11.int, t1.doc11.binary, t2.doc21.int, t2.doc21.binary, t3.doc31.int, t3.doc31.binary
from t1 use document keys, t2 use document keys, t3 use document keys
where (t1.doc11.binary between 'ccc' and 'hhh') and (t2.doc21.binary between 'ggg' and 'iii') and (t3.doc31.binary between 'fff' and 'jjj')
      and (t1.doc11.binary > t2.doc21.binary and t2.doc21.binary > t3.doc31.binary);

#
# clean up
#
drop table t1, t2, t3;
--source include/rpl_end.inc

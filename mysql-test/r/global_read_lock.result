DROP TABLE IF EXISTS t1, t2, t3, t4;
SET @save_read_only=@@global.read_only;
SET @save_super_read_only=@@global.super_read_only;
CREATE TABLE t1(a INT) Engine=InnoDB;
CREATE TABLE t2(a INT) Engine=InnoDB;
CREATE TABLE t3(a INT) Engine=InnoDB;
CREATE TABLE t4(a INT) Engine=InnoDB;
INSERT INTO t1 VALUES(1),(2),(3),(4),(5),(6),(7),(8);
INSERT INTO t1 SELECT 8 + a FROM t1;
INSERT INTO t1 SELECT 16 + a FROM t1;
INSERT INTO t1 SELECT 32 + a FROM t1;
INSERT INTO t2 SELECT a FROM t1;
INSERT INTO t3 SELECT a FROM t1;
BEGIN WORK;
Issuing long running INSERT
INSERT INTO t4 SELECT t1.a * 64 * 64 + t2.a * 64 + t3.a FROM t1, t2, t3;
SELECT command, info FROM information_schema.processlist ORDER BY command, info;
command	info
Query	INSERT INTO t4 SELECT t1.a * 64 * 64 + t2.a * 64 + t3.a FROM t1, t2, t3
Query	SELECT command, info FROM information_schema.processlist ORDER BY command, info
Sleep	NULL
SET GLOBAL super_read_only=1;
SELECT command, info FROM information_schema.processlist ORDER BY command, info;
command	info
Query	INSERT INTO t4 SELECT t1.a * 64 * 64 + t2.a * 64 + t3.a FROM t1, t2, t3
Query	SELECT command, info FROM information_schema.processlist ORDER BY command, info
Sleep	NULL
CREATE TABLE t5 (a INT) Engine=InnoDB;
ERROR HY000: The MySQL server is running with the --read-only (super) option so it cannot execute this statement. 
SELECT COUNT(*) FROM t4;
COUNT(*)
262144
COMMIT;
ERROR HY000: The MySQL server is running with the --read-only (super) option so it cannot execute this statement. 
SELECT COUNT(*) FROM t4;
COUNT(*)
0
SET @@global.super_read_only = @save_super_read_only;
SET @@global.read_only = @save_read_only;
Issuing long running INSERT
INSERT INTO t4 SELECT t1.a * 64 * 64 + t2.a * 64 + t3.a FROM t1, t2, t3;
SELECT command, info FROM information_schema.processlist ORDER BY command, info;
command	info
Query	INSERT INTO t4 SELECT t1.a * 64 * 64 + t2.a * 64 + t3.a FROM t1, t2, t3
Query	SELECT command, info FROM information_schema.processlist ORDER BY command, info
Sleep	NULL
SET GLOBAL super_read_only=1;
SELECT command, info FROM information_schema.processlist ORDER BY command, info;
command	info
Query	INSERT INTO t4 SELECT t1.a * 64 * 64 + t2.a * 64 + t3.a FROM t1, t2, t3
Query	SELECT command, info FROM information_schema.processlist ORDER BY command, info
Sleep	NULL
CREATE TABLE t5 (a INT) Engine=InnoDB;
ERROR HY000: The MySQL server is running with the --read-only (super) option so it cannot execute this statement. 
ERROR HY000: The MySQL server is running with the --read-only (super) option so it cannot execute this statement. 
SELECT COUNT(*) FROM t4;
COUNT(*)
0
SET @@global.super_read_only = @save_super_read_only;
SET @@global.read_only = @save_read_only;
DROP TABLE t1, t2, t3, t4;

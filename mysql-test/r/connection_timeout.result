select "no timeout, should work";
no timeout, should work
no timeout, should work
select "short timeout, should work", sleep(0.70);
short timeout, should work	sleep(0.70)
short timeout, should work	0
select "long timeout, should fail 1s accuracy", sleep(1.3);
ERROR HY000: Read timeout is reached
select "no timeout, should work";
no timeout, should work
no timeout, should work
select "short timeout, should work", sleep(0.5);
short timeout, should work	sleep(0.5)
short timeout, should work	0
select "short timeout, over one second, should also work", sleep(1.2);
short timeout, over one second, should also work	sleep(1.2)
short timeout, over one second, should also work	0
select "long timeout, should 1500ms accuracy", sleep(1.8);
ERROR HY000: Read timeout is reached
ERROR HY000: Can't connect to MySQL server on '192.0.2.1' (101/110)
### mysqld writes error 2006 to the socket before closing a connection
### due to timeout so that client can find out the cause of the lost
### connection by reading the message.
drop table if exists t1;
create table t1 (a1 int primary key, x1 int) engine = innodb;
insert into t1 values (1, 1);
select @@wait_timeout;
@@wait_timeout
28800
select @@interactive_timeout;
@@interactive_timeout
28800
set @orig_wait_timeout = @@wait_timeout;
set @orig_interactive_timeout = @@interactive_timeout;
set @@global.wait_timeout = 3;
set @@global.interactive_timeout = 3;
### (1) Connection gets timed out without executing any queries
sleeping 6 sec to make sure the connection get timed out and closed by server...
waking up...
dump and verify the error 2006 from socket buffer...
Error 2006: HY000Connection closed due to timeout.
### (2) Query results and timeout error will sit in client socket buffer in order
select * from t1;
sleeping 6 sec to make sure the connection get timed out and closed by server...
waking up...
con5 has been closed on server side but the results of 'send show processlist'
should be in cilent buffer already and can be received by 'reap'
a1	x1
1	1
dump and verify the error 2006 from socket buffer...
Error 2006: HY000Connection closed due to timeout.
set @@global.wait_timeout = @orig_wait_timeout;
set @@global.interactive_timeout = @orig_interactive_timeout;
drop table t1;
